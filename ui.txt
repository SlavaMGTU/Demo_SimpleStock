{
    "ClientConfiguration": {
        "ConfigurationName": "Простой склад",
        "ConfigurationDescription": "Автономное решение для простейшего учета",
        "ConfigurationVersion": "0.9.1",
        "Processes": [
            {
                "type": "Process",
                "ProcessName": "Справочники и настройки",
                "PlanFactHeader": "План-факт",
                "DefineOnBackPressed": true,
                "hidden": false,
                "login_screen": false,
                "SC": false,
                "Operations": [
                    {
                        "type": "Operation",
                        "Name": "Меню НСИ",
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "noConfirmation": true,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "send_when_opened": true,
                        "onlineOnInput": false,
                        "DefOnlineOnCreate": "",
                        "DefOnlineOnInput": "",
                        "DefOnCreate": "menu_on_start",
                        "DefOnInput": "menu_input",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "CButtons",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Единицы;Группы;Ячейки;Товары;Настройки",
                                        "Variable": "menu"
                                    }
                                ]
                            }
                        ],
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Единицы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "units_input",
                        "DefOnCreate": "units_on_start",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогЕдиницы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Название",
                                        "Variable": "",
                                        "TextBold": true,
                                        "BackgroundColor": "",
                                        "TextSize": "17",
                                        "TextColor": "#696969"
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@name",
                                        "Variable": "name",
                                        "gravity_horizontal": "left",
                                        "TextSize": "17"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Товары",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_search",
                                "type": "barcode"
                            },
                            {
                                "Value": "",
                                "Variable": "nom_id",
                                "type": "Vision",
                                "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                                "RecognitionTemplate": "Распознавание артикула"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "goods_on_start",
                        "DefOnInput": "goods_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ТоварыЗапись",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сохранить...",
                                        "Variable": "btn_save",
                                        "BackgroundColor": "#E4D00A"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_name",
                                        "Variable": "name"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_barcode",
                                        "Variable": "barcode"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_product_number",
                                        "Variable": "product_number"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_price",
                                        "Variable": "price",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Единица",
                                        "Variable": "",
                                        "TextBold": false
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@units",
                                        "Variable": "unit"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Группа",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@groups",
                                        "Variable": "group"
                                    },
                                    {
                                        "type": "CheckBox",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Уникальный экземпляр",
                                        "Variable": "unique"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": 0,
                                        "width": "wrap_content",
                                        "weight": "1",
                                        "Value": "",
                                        "Variable": "",
                                        "height_value": "0"
                                    }
                                ]
                            },
                            {
                                "Value": "#f2ed",
                                "Variable": "menu_del",
                                "type": "MenuItem"
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_nom",
                                "type": "barcode"
                            },
                            {
                                "Value": "@photoGallery",
                                "Variable": "photoGallery",
                                "type": "HorizontalGallery"
                            },
                            {
                                "Value": "",
                                "Variable": "photo",
                                "type": "photo"
                            },
                            {
                                "Value": "",
                                "Variable": "photo",
                                "type": "photoGallery"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "goods_record_on_start",
                        "DefOnInput": "goods_record_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Группы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "groups_input",
                        "DefOnCreate": "groups_on_start",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогГруппы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Название",
                                        "Variable": "",
                                        "TextBold": true,
                                        "BackgroundColor": "",
                                        "TextSize": "17",
                                        "TextColor": "#696969"
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@name",
                                        "Variable": "name",
                                        "gravity_horizontal": "left",
                                        "TextSize": "17"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Ячейки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "cells_on_start",
                        "DefOnInput": "cells_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ЯчейкиЗапись",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сохранить...",
                                        "Variable": "btn_save",
                                        "BackgroundColor": "#E4D00A"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_name",
                                        "Variable": "name"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_barcode",
                                        "Variable": "barcode"
                                    }
                                ]
                            },
                            {
                                "Value": "#f2ed",
                                "Variable": "menu_del",
                                "type": "MenuItem"
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "cells_record_on_start",
                        "DefOnInput": "cells_record_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    }
                ]
            },
            {
                "ProcessName": "Приемка",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте или выберите ячейку",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cells",
                                        "Variable": "cell"
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "income_cell_on_start",
                        "DefOnInput": "income_cell_on_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Выбор товара",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте товар",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            },
                            {
                                "Value": "",
                                "Variable": "nom_id",
                                "type": "Vision",
                                "Elements": [],
                                "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                                "RecognitionTemplate": "Распознавание артикула"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "",
                        "DefOnInput": "income_nom_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Ввод количества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Укажите количество",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товар",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол-во",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "@qty",
                                                "Variable": "qty",
                                                "BackgroundColor": "#F7ECEB",
                                                "TextBold": true
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "income_qty_input",
                        "onlineOnAfterStart": false
                    }
                ],
                "PlanFactHeader": "Состав"
            },
            {
                "ProcessName": "Отгрузка",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте или выберите ячейку",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cells",
                                        "Variable": "cell"
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "income_cell_on_start",
                        "DefOnInput": "income_cell_on_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Выбор товара",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте товар",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            },
                            {
                                "Value": "",
                                "Variable": "nom_id",
                                "type": "Vision",
                                "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                                "RecognitionTemplate": "Распознавание артикула"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "",
                        "DefOnInput": "income_nom_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Ввод количества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Укажите количество",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товар",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол-во",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "@qty",
                                                "Variable": "qty",
                                                "BackgroundColor": "#F7ECEB",
                                                "TextBold": true
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "outcome_qty_input",
                        "onlineOnAfterStart": false
                    }
                ],
                "PlanFactHeader": "Состав"
            },
            {
                "ProcessName": "Остатки",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Остатки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте ячейку или товар чтобы посмотреть остатки",
                                        "Variable": "",
                                        "TextSize": "20",
                                        "BackgroundColor": "#3B5958",
                                        "TextColor": "#FFFFFF"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table",
                                        "Variable": ""
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "stock_on_create",
                        "DefOnInput": "stock_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Остатки по объекту",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Объект",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@object",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table_object",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "noConfirmation": true,
                        "DefOnInput": "stock_object_input",
                        "onlineOnAfterStart": false
                    }
                ]
            },
            {
                "ProcessName": "Инвентаризация Active CV",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Документы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Создайте новый или продолжите существующий документ",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Создать инвентаризацию",
                                        "Variable": "btn_new",
                                        "BackgroundColor": "#3CB371"
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@inventory",
                                        "Variable": "doc"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "inventory_on_start",
                        "DefOnInput": "inventory_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Новая инвентаризация",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Комментарий/Название",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "name"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "newinv_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогВводКоличества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "wrap_content",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол.:",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "",
                                                "Variable": "qty"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": false,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Инвентаризация Результаты",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@inv",
                                        "Variable": "",
                                        "TextSize": "18"
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Начать сканирование",
                                        "Variable": "btn_run"
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Начать сканирование(OCR)",
                                        "Variable": "btn_run_ocr"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "invres_on_start",
                        "DefOnInput": "invres_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    }
                ],
                "hidden": false
            },
            {
                "CVOperationName": "ИнвCV",
                "type": "CVOperation",
                "CVFrames": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "Barcode",
                        "CVResolution": "HD720",
                        "CVMode": "green_and_grey",
                        "CVActionButtons": "",
                        "CVAction": "Сканируйте Штрихкод ячейки",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnCreate": "invcv_cell_on_start",
                        "CVFrameDefOnNewObject": "invcv_cell_on_new_object",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула"
                    },
                    {
                        "Name": "Товары ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "Barcode",
                        "CVResolution": "HD720",
                        "CVMode": "list_and_grey",
                        "CVActionButtons": "К ЯЧЕЙКЕ",
                        "CVAction": "Сканируйте штрихкоды товара",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnNewObject": "invcv_goods_on_new_object",
                        "CVFrameDefAction": "invcv_goods_action",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула",
                        "CVRecognitionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}"
                    }
                ],
                "hidden": true
            },
            {
                "CVOperationName": "ИнвCVOCR",
                "type": "CVOperation",
                "CVFrames": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "Barcode",
                        "CVResolution": "HD720",
                        "CVMode": "green_and_grey",
                        "CVActionButtons": "",
                        "CVAction": "Сканируйте Штрихкод ячейки",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnCreate": "invcv_cell_on_start",
                        "CVFrameDefOnNewObject": "invcv_cell_on_new_object_ocr",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула"
                    },
                    {
                        "Name": "Товары ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "OCR",
                        "CVResolution": "HD720",
                        "CVMode": "list_and_grey",
                        "CVActionButtons": "К ЯЧЕЙКЕ",
                        "CVAction": "Сканируйте артикулы товара",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnNewObject": "invcv_goods_on_new_object",
                        "CVFrameDefAction": "invcv_goods_action",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула",
                        "CVRecognitionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}"
                    }
                ],
                "hidden": true
            },
            {
                "CVOperationName": "Новая операция ActiveCV",
                "type": "CVOperation",
                "CVFrames": []
            },
            {
                "ProcessName": "1113",
                "type": "Process",
                "Operations": [],
                "hidden": false,
                "SC": false
            }
        ],
        "ConfigurationSettings": {
            "uid": "f164e78e7f8f480da045102a42812cdb"
        },
        "ConfigurationTags": "Py,off-line,ActiveCV®",
        "RunPython": true,
        "PyHandlers": "aW1wb3J0IHVpX2dsb2JhbApmcm9tIHBvbnkub3JtLmNvcmUgaW1wb3J0IGRiX3Nlc3Npb24KZnJvbSBwb255IGltcG9ydCBvcm0KZnJvbSBwb255Lm9ybSBpbXBvcnQgRGF0YWJhc2UsUmVxdWlyZWQsU2V0LHNlbGVjdCxjb21taXQKaW1wb3J0IGpzb24KaW1wb3J0IG9zCmltcG9ydCBzcWxpdGUzICMgVGhpcyBpcyBhbm90aGVyIHdheSB0byB3b3JrIHdpdGggU1FMCmZyb20gc3FsaXRlMy5kYmFwaTIgaW1wb3J0IEVycm9yCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gUElMIGltcG9ydCBJbWFnZQoKCgp1bml0X2lkPS0xCm5vbV9pZD0tMQpjZWxsX2lkPS0xCmNlbGxzPXt9CmNlbGxpZD1Ob25lCmZvdW5kPVtdCmdyZWVuX3NpemU9MAp5ZWxsb3dfc2l6ZT0wCgoKZGVmIGluaXRfb25fc3RhcnQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIHVpX2dsb2JhbC5pbml0KCkKICAgIHJldHVybiBoYXNoTWFwCgpkZWYgbWVudV9pbnB1dChoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJtZW51IjoKICAgICAgICBpZiBoYXNoTWFwLmdldCgibWVudSIpPT0i0JXQtNC40L3QuNGG0YsiOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCV0LTQuNC90LjRhtGLIikKICAgICAgICBpZiBoYXNoTWFwLmdldCgibWVudSIpPT0i0JPRgNGD0L/Qv9GLIjoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQk9GA0YPQv9C/0YsiKSAKICAgICAgICBpZiBoYXNoTWFwLmdldCgibWVudSIpPT0i0K/Rh9C10LnQutC4IjoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQr9GH0LXQudC60LgiKSAgICAgICAgICAgCiAgICAgICAgZWxpZiBoYXNoTWFwLmdldCgibWVudSIpPT0i0KLQvtCy0LDRgNGLIjoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQotC+0LLQsNGA0YsiKSAgICAKICAgIGVsaWYgIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0nT05fQkFDS19QUkVTU0VEJzogCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJGaW5pc2hQcm9jZXNzIiwiIikgICAgIAogICAgcmV0dXJuIGhhc2hNYXAKCmRlZiBtZW51X29uX3N0YXJ0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICAjaGFzaE1hcC5wdXQoImdldGZpbGVzIiwiIikgCiAgICAjaGFzaE1hcC5wdXQoInRvYXN0IiwidGVzdDEiKSAgICAKICAgIHJldHVybiBoYXNoTWFwCgoKIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLdCV0LTQuNC90LjRhtGLCmRlZiB1bml0c19vbl9zdGFydChoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgoKICAgIHRhYmxlICA9IHsKICAgICJ0eXBlIjogInRhYmxlIiwKICAgICJ0ZXh0c2l6ZSI6ICIyMCIsCgogICAgImNvbHVtbnMiOiBbCiAgICB7CiAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgImhlYWRlciI6ICLQndCw0LjQvNC10L3QvtCy0LDQvdC40LUiLAogICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgIH0KICAgIF0KICAgIH0KICAgICN3b3JrIHdpdGggU1FMIHZpYSBQb255IE9STQogICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfVW5pdHMpCiAgICByb3dzPVtdCiAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgogICAgICAgIHJvd3MuYXBwZW5kKHsibmFtZSI6cmVjb3JkLm5hbWUsImlkIjpyZWNvcmQuaWR9KQoKICAgIHRhYmxlWydyb3dzJ10gPXJvd3MgICAKICAgIGhhc2hNYXAucHV0KCJsaXN0Iixqc29uLmR1bXBzKHRhYmxlKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKZGVmIHVuaXRzX2lucHV0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgdW5pdF9pZAogICAgCiAgICBpZiAgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSdPTl9CQUNLX1BSRVNTRUQnOiAKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCc0LXQvdGOINCd0KHQmCIpICAKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iYnRuX2FkZCI6CiAgICAgICAgaGFzaE1hcC5wdXQoIm5hbWUiLCIiKQogICAgICAgIHVuaXRfaWQ9LTEKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZyIsItCU0LjQsNC70L7Qs9CV0LTQuNC90LjRhtGLIikKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZ1N0eWxlIixqc29uLmR1bXBzKHsidGl0bGUiOiAi0JTQvtCx0LDQstC70LXQvdC40LUg0LfQsNC/0LjRgdC4IiwgInllcyI6ICLQodC+0YXRgNCw0L3QuNGC0YwiLCAgICJubyI6ICLQntGC0LzQtdC90LAiIH0pKQogICAgICAKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJUYWJsZUNsaWNrIjogICAgCiAgICAgICAgCiAgICAgICAganJlY29yZCA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoInNlbGVjdGVkX2xpbmUiKSkKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoanJlY29yZFsnaWQnXSkpCiAgICAgICAgdW5pdF9pZCA9anJlY29yZFsnaWQnXQogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIixqcmVjb3JkWyduYW1lJ10pCiAgICAgICAgCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2ciLCLQlNC40LDQu9C+0LPQldC00LjQvdC40YbRiyIpCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2dTdHlsZSIsanNvbi5kdW1wcyh7InRpdGxlIjogItCU0L7QsdCw0LLQu9C10L3QuNC1INC30LDQv9C40YHQuCIsICJ5ZXMiOiAi0KHQvtGF0YDQsNC90LjRgtGMIiwgICAibm8iOiAi0J7RgtC80LXQvdCwIiB9KSkKICAgIGVsaWYgIGhhc2hNYXAuZ2V0KCJldmVudCIpPT0ib25SZXN1bHRQb3NpdGl2ZSI6CiAgICAgICAgI2hhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKHVuaXRfaWQpKQogICAgICAgIGlmIHVuaXRfaWQ8MDoKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Vbml0cyhuYW1lPWhhc2hNYXAuZ2V0KCduYW1lJykpCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIGlmIGhhc2hNYXAuZ2V0KCduYW1lJyk9PSIiOiAj0YPQtNCw0LvQtdC90LjQtQogICAgICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfVW5pdHNbdW5pdF9pZF0KICAgICAgICAgICAgICAgICAgICByLmRlbGV0ZSgpCiAgICAgICAgICAgICAgICBlbHNlOiAgI9GA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LUgIAogICAgICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfVW5pdHNbdW5pdF9pZF0KICAgICAgICAgICAgICAgICAgICByLm5hbWUgPSBoYXNoTWFwLmdldCgnbmFtZScpCgogICAgICAgICAgICAgICAgY29tbWl0KCkKICAgIAogICAgcmV0dXJuIGhhc2hNYXAgICAgCgojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t0JPRgNGD0L/Qv9GLCmRlZiBncm91cHNfb25fc3RhcnQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKCiAgICB0YWJsZSAgPSB7CiAgICAidHlwZSI6ICJ0YWJsZSIsCiAgICAidGV4dHNpemUiOiAiMjAiLAoKICAgICJjb2x1bW5zIjogWwogICAgewogICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICJoZWFkZXIiOiAi0J3QsNC40LzQtdC90L7QstCw0L3QuNC1IiwKICAgICAgICAid2VpZ2h0IjogIjEiCiAgICB9CiAgICBdCiAgICB9CiAgICAjd29yayB3aXRoIFNRTCB2aWEgUG9ueSBPUk0KICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0dyb3VwcykKICAgIHJvd3M9W10KICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgcm93cy5hcHBlbmQoeyJuYW1lIjpyZWNvcmQubmFtZSwiaWQiOnJlY29yZC5pZH0pCgogICAgdGFibGVbJ3Jvd3MnXSA9cm93cyAgIAogICAgaGFzaE1hcC5wdXQoImxpc3QiLGpzb24uZHVtcHModGFibGUpKQoKICAgIHJldHVybiBoYXNoTWFwCgpkZWYgZ3JvdXBzX2lucHV0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgdW5pdF9pZAoKICAgIGlmICBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09J09OX0JBQ0tfUFJFU1NFRCc6IAogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0JzQtdC90Y4g0J3QodCYIikgCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iYnRuX2FkZCI6CiAgICAgICAgaGFzaE1hcC5wdXQoIm5hbWUiLCIiKQogICAgICAgIHVuaXRfaWQ9LTEKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZyIsItCU0LjQsNC70L7Qs9CT0YDRg9C/0L/RiyIpCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2dTdHlsZSIsanNvbi5kdW1wcyh7InRpdGxlIjogItCU0L7QsdCw0LLQu9C10L3QuNC1INC30LDQv9C40YHQuCIsICJ5ZXMiOiAi0KHQvtGF0YDQsNC90LjRgtGMIiwgICAibm8iOiAi0J7RgtC80LXQvdCwIiB9KSkKICAgICAgCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iVGFibGVDbGljayI6ICAgIAogICAgICAgIAogICAgICAgIGpyZWNvcmQgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9saW5lIikpCiAgICAgICAgI2hhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGpyZWNvcmRbJ2lkJ10pKQogICAgICAgIHVuaXRfaWQgPWpyZWNvcmRbJ2lkJ10KICAgICAgICBoYXNoTWFwLnB1dCgibmFtZSIsanJlY29yZFsnbmFtZSddKQogICAgICAgIAogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nIiwi0JTQuNCw0LvQvtCz0JPRgNGD0L/Qv9GLIikKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZ1N0eWxlIixqc29uLmR1bXBzKHsidGl0bGUiOiAi0JTQvtCx0LDQstC70LXQvdC40LUg0LfQsNC/0LjRgdC4IiwgInllcyI6ICLQodC+0YXRgNCw0L3QuNGC0YwiLCAgICJubyI6ICLQntGC0LzQtdC90LAiIH0pKQogICAgZWxpZiAgaGFzaE1hcC5nZXQoImV2ZW50Iik9PSJvblJlc3VsdFBvc2l0aXZlIjoKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IixzdHIodW5pdF9pZCkpCiAgICAgICAgaWYgdW5pdF9pZDwwOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dyb3VwcyhuYW1lPWhhc2hNYXAuZ2V0KCduYW1lJykpCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIGlmIGhhc2hNYXAuZ2V0KCduYW1lJyk9PSIiOiAj0YPQtNCw0LvQtdC90LjQtQogICAgICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfR3JvdXBzW3VuaXRfaWRdCiAgICAgICAgICAgICAgICAgICAgci5kZWxldGUoKQogICAgICAgICAgICAgICAgZWxzZTogICPRgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNC1ICAKICAgICAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dyb3Vwc1t1bml0X2lkXQogICAgICAgICAgICAgICAgICAgIHIubmFtZSA9IGhhc2hNYXAuZ2V0KCduYW1lJykKCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgICAgICAgICAgCgogICAgcmV0dXJuIGhhc2hNYXAgICAgCgojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS3QotC+0LLQsNGA0YsKZGVmIGdvb2RzX29uX3N0YXJ0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICBoYXNoTWFwLnB1dCgibW1fbG9jYWwiLCIiKQogICAgaGFzaE1hcC5wdXQoIm1tX2NvbXByZXNzaW9uIiwiNzAiKQogICAgaGFzaE1hcC5wdXQoIm1tX3NpemUiLCI2NSIpCgogICAgbGlzdCA9IHsgImN1c3RvbWNhcmRzIjogICAgICAgICB7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgICJsYXlvdXQiOiB7CiAgICAgICAgICAgICJ0eXBlIjogIkxpbmVhckxheW91dCIsCiAgICAgICAgICAgICJvcmllbnRhdGlvbiI6ICJ2ZXJ0aWNhbCIsCiAgICAgICAgICAgICJoZWlnaHQiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgIndpZHRoIjogIm1hdGNoX3BhcmVudCIsCiAgICAgICAgICAgICJ3ZWlnaHQiOiAiMCIsCiAgICAgICAgICAgICJFbGVtZW50cyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInR5cGUiOiAiTGluZWFyTGF5b3V0IiwKICAgICAgICAgICAgICAgICJvcmllbnRhdGlvbiI6ICJob3Jpem9udGFsIiwKICAgICAgICAgICAgICAgICJoZWlnaHQiOiAid3JhcF9jb250ZW50IiwKICAgICAgICAgICAgICAgICJ3aWR0aCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIwIiwKICAgICAgICAgICAgICAgICJFbGVtZW50cyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIlBpY3R1cmUiLAogICAgICAgICAgICAgICAgInNob3dfYnlfY29uZGl0aW9uIjogIiIsCiAgICAgICAgICAgICAgICAiVmFsdWUiOiAiQHBpYyIsCiAgICAgICAgICAgICAgICAiTm9SZWZyZXNoIjogRmFsc2UsCiAgICAgICAgICAgICAgICAiZG9jdW1lbnRfdHlwZSI6ICIiLAogICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICJWYXJpYWJsZSI6ICIiLAogICAgICAgICAgICAgICAgIlRleHRTaXplIjogIjE2IiwKICAgICAgICAgICAgICAgICJUZXh0Q29sb3IiOiAiI0RCNzA5MyIsCiAgICAgICAgICAgICAgICAiVGV4dEJvbGQiOiBUcnVlLAogICAgICAgICAgICAgICAgIlRleHRJdGFsaWMiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJCYWNrZ3JvdW5kQ29sb3IiOiAiIiwKICAgICAgICAgICAgICAgICJ3aWR0aCI6ICI3NSIsCiAgICAgICAgICAgICAgICAiaGVpZ2h0IjogIjc1IiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInR5cGUiOiAiTGluZWFyTGF5b3V0IiwKICAgICAgICAgICAgICAgICJvcmllbnRhdGlvbiI6ICJ2ZXJ0aWNhbCIsCiAgICAgICAgICAgICAgICAiaGVpZ2h0IjogIndyYXBfY29udGVudCIsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIsCiAgICAgICAgICAgICAgICAiRWxlbWVudHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJUZXh0VmlldyIsCiAgICAgICAgICAgICAgICAgICAgInNob3dfYnlfY29uZGl0aW9uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhbHVlIjogIkBwcm9kdWN0X251bWJlciIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJUZXh0VmlldyIsCiAgICAgICAgICAgICAgICAgICAgInNob3dfYnlfY29uZGl0aW9uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhbHVlIjogIkBiYXJjb2RlIiwKICAgICAgICAgICAgICAgICAgICAiTm9SZWZyZXNoIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImRvY3VtZW50X3R5cGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibWFzayI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYXJpYWJsZSI6ICIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KICAgICAgICAgICAgCiAgICB9CiAgICB9CiAgICAKICAgICNfZmlsZXMgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJfZmlsZXMiKSkKICAgIAoKICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0dvb2RzKQogICAgbGlzdFsiY3VzdG9tY2FyZHMiXVsiY2FyZHNkYXRhIl09W10KICAgIAogICAgZm9yIHJlY29yZCBpbiBxdWVyeToKICAgICAgICAKICAgICAgICBwaWM9IiIKICAgICAgICBpZiAncGhvdG8nIGluIHJlY29yZC5waWN0dXJlcyA6CiAgICAgICAgCiAgICAgICAgICAgIHAgPSByZWNvcmQucGljdHVyZXNbJ3Bob3RvJ10KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgbGVuKHApPjA6CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBqZiBpbiBfZmlsZXM6ICPQvdCw0YXQvtC00LjQvCDQv9GD0YLRjCDQuiDRhNCw0LnQu9GDINC/0L4g0LjQtNC10L3RgtC40YTQuNC60LDRgtC+0YDRgwogICAgICAgICAgICAgICAgICAgICAgICBpZiBqZlsnaWQnXT09cFswXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoamZbJ3BhdGgnXSk6IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWMgPSJ+IitqZlsncGF0aCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBsaXN0WyJjdXN0b21jYXJkcyJdWyJjYXJkc2RhdGEiXS5hcHBlbmQoeyJuYW1lIjpyZWNvcmQubmFtZSwia2V5IjpyZWNvcmQuaWQsInByb2R1Y3RfbnVtYmVyIjpzdHIocmVjb3JkLnByb2R1Y3RfbnVtYmVyKSwiYmFyY29kZSI6c3RyKHJlY29yZC5iYXJjb2RlKSwgInVuaXQiOnN0cihyZWNvcmQudW5pdCksICJza3Vncm91cCI6c3RyKHJlY29yZC5ncm91cCksInByaWNlIjpyZWNvcmQucHJpY2UsInVuaXF1ZSI6cmVjb3JkLnVuaXF1ZSwicGljdHVyZXMiOmpzb24uZHVtcHMocmVjb3JkLnBpY3R1cmVzKSwicGljIjpwaWN9KSAgICAgICAgICAgICAgICAgICAgICAKCiAgICAjZm9yIG4gaW4gcmFuZ2UoMTAwMDApOgogICAgCiAgICAjICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdLmFwcGVuZCh7Im5hbWUiOiLQotC10YHRgtC+0LLRi9C5INGC0L7QstCw0YAgIitzdHIobiksImtleSI6biwicHJvZHVjdF9udW1iZXIiOnN0cihuKSwiYmFyY29kZSI6c3RyKG4pLCAidW5pdCI6ItCo0YIuIiwgInNrdWdyb3VwIjoi0KLQtdGB0YIiLCJwcmljZSI6MSwidW5pcXVlIjpUcnVlLCJwaWN0dXJlcyI6W10sInBpYyI6IiJ9KSAgICAgICAgICAgICAgICAgICAgICAKCiAgICBoYXNoTWFwLnB1dCgibGlzdCIsanNvbi5kdW1wcyhsaXN0KSkKCiAgICByZXR1cm4gaGFzaE1hcAoKZGVmIG9wZW5fbm9tKGhhc2hNYXAsbm9tX2lkLGtleSk6CiAgICAgICAgamxpc3QgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJsaXN0IikpCiAgICAgICAgZ29vZHNhcnJheSA9IGpsaXN0WyJjdXN0b21jYXJkcyJdWydjYXJkc2RhdGEnXQogICAgICAgIAogICAgICAgIGpyZWNvcmQgPSBuZXh0KGl0ZW0gZm9yIGl0ZW0gaW4gZ29vZHNhcnJheSBpZiBzdHIoaXRlbVsia2V5Il0pID09IGtleSkKCiAgICAgICAgbm9tX2lkID1qcmVjb3JkWydrZXknXQogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIixqcmVjb3JkWyduYW1lJ10pCiAgICAgICAgaGFzaE1hcC5wdXQoImJhcmNvZGUiLGpyZWNvcmRbJ2JhcmNvZGUnXSkKICAgICAgICBoYXNoTWFwLnB1dCgidW5pdCIsanJlY29yZFsndW5pdCddKQogICAgICAgIGhhc2hNYXAucHV0KCJncm91cCIsanJlY29yZFsnc2t1Z3JvdXAnXSkKICAgICAgICBoYXNoTWFwLnB1dCgicHJpY2UiLHN0cihqcmVjb3JkWydwcmljZSddKSkKICAgICAgICBoYXNoTWFwLnB1dCgicHJvZHVjdF9udW1iZXIiLGpyZWNvcmRbJ3Byb2R1Y3RfbnVtYmVyJ10pCgogICAgICAgIGlmIGpyZWNvcmRbJ3VuaXF1ZSddPT0xOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidW5pcXVlIiwidHJ1ZSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInVuaXF1ZSIsImZhbHNlIikKCgogICAgICAgICNpZiBsZW4oc3RyKGpyZWNvcmRbJ3BpY3R1cmVzJ10pKT4wOgogICAgICAgIGpnID0ganNvbi5sb2FkcyhqcmVjb3JkWydwaWN0dXJlcyddKQogICAgICAgIGlmICdwaG90bycgaW4gamc6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJwaG90b0dhbGxlcnkiLGpzb24uZHVtcHMoamdbJ3Bob3RvJ10pKSAKICAgICAgICBlbHNlOiAgICAKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsanNvbi5kdW1wcyhbXSkpIAogICAgICAgIAogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0KLQvtCy0LDRgNGL0JfQsNC/0LjRgdGMIikKCiAgICAgICAgcmV0dXJuIGhhc2hNYXAsbm9tX2lkCgpkZWYgZ29vZHNfaW5wdXQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBub21faWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09ImJ0bl9hZGQiOgogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIiwiIikKICAgICAgICBoYXNoTWFwLnB1dCgiYmFyY29kZSIsIiIpCiAgICAgICAgaGFzaE1hcC5wdXQoInVuaXQiLCIiKQogICAgICAgIGhhc2hNYXAucHV0KCJncm91cCIsIiIpCiAgICAgICAgaGFzaE1hcC5wdXQoInByaWNlIiwiMCIpCiAgICAgICAgaGFzaE1hcC5wdXQoInVuaXF1ZSIsImZhbHNlIikKICAgICAgICBoYXNoTWFwLnB1dCgicHJvZHVjdF9udW1iZXIiLCIiKQogCgogICAgICAgIGhhc2hNYXAucHV0KCJwaG90b0dhbGxlcnkiLGpzb24uZHVtcHMoW10pKSAj0L/Rg9GB0YLQvtC5INGB0L/QuNGB0L7QuiDQv9C+0LQg0LPQsNC70LXRgNC10Y4KCiAgICAgICAgbm9tX2lkPS0xCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQotC+0LLQsNGA0YvQl9Cw0L/QuNGB0YwiKQogICAgICAgIAogICAgICAKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJDYXJkc0NsaWNrIjogICAgCiAgICAgICAgCiAgICAgICAgaGFzaE1hcCxub21faWQgPSBvcGVuX25vbShoYXNoTWFwLG5vbV9pZCxoYXNoTWFwLmdldCgic2VsZWN0ZWRfY2FyZF9rZXkiKSkKICAgICAgICAKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJiYXJjb2RlIjoKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgiYmFyY29kZV9pbnB1dCIpKQogICAgICAgIG5vbSA9IHVpX2dsb2JhbC5TV19Hb29kcy5nZXQoYmFyY29kZT1oYXNoTWFwLmdldCgiYmFyY29kZV9zZWFyY2giKSkKICAgICAgICBpZiBub209PU5vbmU6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCi0L7QstCw0YAg0L3QtSDQvdCw0LnQtNC10L0iKQogICAgICAgIGVsc2U6ICAgIAogICAgICAgICAgICBoYXNoTWFwLG5vbV9pZCA9IG9wZW5fbm9tKGhhc2hNYXAsbm9tX2lkLHN0cihub20uaWQpKQogICAgICAgICAgICAKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInNwZWFrIixub20ubmFtZSkKICAgICAgICAgICAgCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09InZpc2lvbiI6CiAgICAgICAgICAgICNoYXNoTWFwLnB1dCgidG9hc3QiLGhhc2hNYXAuZ2V0KCJub21faWQiKSkKICAgICAgICAgICAgbm9tID0gdWlfZ2xvYmFsLlNXX0dvb2RzLmdldChpZD1pbnQoaGFzaE1hcC5nZXQoIm5vbV9pZCIpKSkKICAgICAgICAgICAgaWYgbm9tPT1Ob25lOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0KLQvtCy0LDRgCDQvdC1INC90LDQudC00LXQvSIpCiAgICAgICAgICAgIGVsc2U6ICAgIAogICAgICAgICAgICAgICAgaGFzaE1hcCxub21faWQgPSBvcGVuX25vbShoYXNoTWFwLG5vbV9pZCxzdHIobm9tLmlkKSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJzcGVhayIsbm9tLm5hbWUpCiAgICBlbGlmICBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09J09OX0JBQ0tfUFJFU1NFRCc6IAogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0JzQtdC90Y4g0J3QodCYIikgICAgICAgICAgICAgCgogICAgcmV0dXJuIGhhc2hNYXAgCgpkZWYgZ29vZHNfcmVjb3JkX29uX3N0YXJ0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICBoYXNoTWFwLnB1dCgibW1fbG9jYWwiLCIiKQogICAgaGFzaE1hcC5wdXQoIm1tX2NvbXByZXNzaW9uIiwiNzAiKQogICAgaGFzaE1hcC5wdXQoIm1tX3NpemUiLCI2NSIpCiAgICAKICAgIGhhc2hNYXAucHV0KCJmaWxsX25hbWUiLGpzb24uZHVtcHMoeyJoaW50Ijoi0J3QsNC40LzQtdC90L7QstCw0L3QuNC1IiwiZGVmYXVsdF90ZXh0IjpoYXNoTWFwLmdldCgibmFtZSIpfSkpCiAgICBoYXNoTWFwLnB1dCgiZmlsbF9iYXJjb2RlIixqc29uLmR1bXBzKHsiaGludCI6ItCo0YLRgNC40YXQutC+0LQiLCJkZWZhdWx0X3RleHQiOmhhc2hNYXAuZ2V0KCJiYXJjb2RlIil9KSkKICAgIGhhc2hNYXAucHV0KCJmaWxsX3Byb2R1Y3RfbnVtYmVyIixqc29uLmR1bXBzKHsiaGludCI6ItCQ0YDRgtC40LrRg9C7IiwiZGVmYXVsdF90ZXh0IjpoYXNoTWFwLmdldCgicHJvZHVjdF9udW1iZXIiKX0pKQogICAgaGFzaE1hcC5wdXQoImZpbGxfcHJpY2UiLGpzb24uZHVtcHMoeyJoaW50Ijoi0KbQtdC90LAiLCJkZWZhdWx0X3RleHQiOmhhc2hNYXAuZ2V0KCJwcmljZSIpfSkpCgogICAgdW5pdHMgPSBbXQogICAgdW5pdHMuYXBwZW5kKCI80LLRi9Cx0LXRgNC40YLQtSDQtdC00LjQvdC40YbRgy4uLj4iKQogICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfVW5pdHMpCiAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgogICAgICAgIHVuaXRzLmFwcGVuZChyZWNvcmQubmFtZSkKCiAgICBoYXNoTWFwLnB1dCgidW5pdHMiLCI7Ii5qb2luKHVuaXRzKSkKCiAgICBncm91cHMgPSBbXQogICAgZ3JvdXBzLmFwcGVuZCgiPNCy0YvQsdC10YDQuNGC0LUg0LPRgNGD0L/Qv9GDLi4uPiIpCiAgICBxdWVyeSA9IHNlbGVjdChjIGZvciBjIGluIHVpX2dsb2JhbC5TV19Hcm91cHMpCiAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgogICAgICAgIGdyb3Vwcy5hcHBlbmQocmVjb3JkLm5hbWUpCgogICAgaGFzaE1hcC5wdXQoImdyb3VwcyIsIjsiLmpvaW4oZ3JvdXBzKSkKICAgIAogICAgI2hhc2hNYXAucHV0KCJ0b2FzdCIsaGFzaE1hcC5nZXQoInBob3RvR2FsbGVyeSIpKQoKICAgIHJldHVybiBoYXNoTWFwCgpkZWYgZ2V0X2lmX2V4aXN0KGhhc2hNYXAsZmllbGQpOgogICAgaWYgaGFzaE1hcC5jb250YWluc0tleShmaWVsZCk6CiAgICAgICAgICAgIHJlcyA9aGFzaE1hcC5nZXQoZmllbGQpCiAgICBlbHNlOgogICAgICAgICAgICByZXMgPSIiCiAgICByZXR1cm4gcmVzCgpkZWYgZ2V0Ym9vbGVhbl9pZl9leGlzdChoYXNoTWFwLGZpZWxkKToKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KGZpZWxkKToKICAgICAgICAgICAgcmVzID0wCiAgICBlbHNlOgogICAgICAgICAgICBpZiBoYXNoTWFwLmdldChmaWVsZCk9PSJ0cnVlIjoKICAgICAgICAgICAgICAgIHJlcyA9MQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzPTAKCgogICAgcmV0dXJuIHJlcyAgICAKCmRlZiBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLGZpZWxkKToKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KGZpZWxkKToKICAgICAgICAgICAgcmVzID0wCiAgICBlbHNlOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzPWZsb2F0KGhhc2hNYXAuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gMAogICAgcmV0dXJuIHJlcyAgICAKCmRlZiBzYXZlX25vbShoYXNoTWFwKToKICAgIGdsb2JhbCBub21faWQKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KCJuYW1lIik6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCd0LUg0YPQutCw0LfQsNC90L4g0L3QsNC40LzQtdC90L7QstCw0L3QuNC1IikgCiAgICAgICAgICAgIHJldHVybiBoYXNoTWFwLEZhbHNlICAKICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGxlbihoYXNoTWFwLmdldCgibmFtZSIpKT09MDoKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCd0LUg0YPQutCw0LfQsNC90L4g0L3QsNC40LzQtdC90L7QstCw0L3QuNC1IikgCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzaE1hcCxGYWxzZSAgCgogICAgaWYgbm90IGhhc2hNYXAuY29udGFpbnNLZXkoInVuaXQiKToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QtSDRg9C60LDQt9Cw0L3QsCDQtdC00LjQvdC40YbQsCIpIAogICAgICAgICAgICByZXR1cm4gaGFzaE1hcCxGYWxzZSAgCiAgICBlbHNlOgogICAgICAgICAgICBpZiBsZW4oaGFzaE1hcC5nZXQoInVuaXQiKSk9PTA6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCLQndC1INGD0LrQsNC30LDQvdCwINC10LTQuNC90LjRhtCwIikgCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzaE1hcCxGYWxzZSAgICAgICAKCiAgICBpZiBub21faWQ8MDoKICAgICAgICAgICAgCgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dvb2RzKG5hbWU9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsIm5hbWUiKSxiYXJjb2RlPWdldF9pZl9leGlzdChoYXNoTWFwLCJiYXJjb2RlIiksdW5pdCA9IGdldF9pZl9leGlzdChoYXNoTWFwLCJ1bml0IiksZ3JvdXA9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsImdyb3VwIikscHJvZHVjdF9udW1iZXI9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsInByb2R1Y3RfbnVtYmVyIikscHJpY2U9Z2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwicHJpY2UiKSx1bmlxdWUgPSBnZXRib29sZWFuX2lmX2V4aXN0KGhhc2hNYXAsInVuaXF1ZSIpKQogICAgICAgICAgICAgICAgbm9tX2lkPXIuaWQKICAgICAgICAgICAgICAgIGNvbW1pdCgpCiAgICBlbHNlOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfR29vZHNbbm9tX2lkXQogICAgICAgICAgICAgICAgci5uYW1lID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsIm5hbWUiKQogICAgICAgICAgICAgICAgci5iYXJjb2RlID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsImJhcmNvZGUiKQogICAgICAgICAgICAgICAgci51bml0ID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsInVuaXQiKQogICAgICAgICAgICAgICAgci5ncm91cCA9IGdldF9pZl9leGlzdChoYXNoTWFwLCJncm91cCIpCiAgICAgICAgICAgICAgICByLnByb2R1Y3RfbnVtYmVyID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsInByb2R1Y3RfbnVtYmVyIikKICAgICAgICAgICAgICAgIHIucHJpY2UgPSBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCJwcmljZSIpCiAgICAgICAgICAgICAgICByLnVuaXF1ZSA9IGdldGJvb2xlYW5faWZfZXhpc3QoaGFzaE1hcCwidW5pcXVlIikKCiAgICAgICAgICAgICAgICBqID0ge30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgalsncGhvdG8nXSA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoInBob3RvR2FsbGVyeSIpKQogICAgICAgICAgICAgICAgci5waWN0dXJlcz1qCgogICAgICAgICAgICAgICAgY29tbWl0KCkKICAgIHJldHVybiBoYXNoTWFwLFRydWUKCmRlZiBnb29kc19yZWNvcmRfaW5wdXQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBub21faWQKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iYnRuX3NhdmUiOgogICAgICAgICNoYXNoTWFwLnB1dCgidG9hc3QiLHN0cihoYXNoTWFwLmdldCgidW5pcXVlIikpKQoKICAgICAgICBoYXNoTWFwLHN1Y2Nlc3MgPSBzYXZlX25vbShoYXNoTWFwKQogICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0KLQvtCy0LDRgNGLIikgCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09ImJhcmNvZGUiOgogICAgICAgIGhhc2hNYXAucHV0KCJiYXJjb2RlIixoYXNoTWFwLmdldCgiYmFyY29kZV9ub20iKSkKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iQ2FyZHNDbGljayI6CiAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoaGFzaE1hcC5nZXQoInNlbGVjdGVkX2NhcmRfa2V5IikpKQoKICAgIGVsaWYgIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0nT05fQkFDS19QUkVTU0VEJzogCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQotC+0LLQsNGA0YsiKSAKCiAgICBlbGlmICBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09J21lbnVfZGVsJzogCiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dvb2RzW25vbV9pZF0KICAgICAgICAgICAgci5kZWxldGUoKQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0KLQvtCy0LDRgNGLIikgIAogICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCj0LTQsNC70LXQvdC+Li4uIikgICAgCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09InBob3RvIjoKCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgI9Cc0L7QttC90L4g0LLQvtC+0LHRidC1INGN0YLQvtCz0L4g0L3QtSDQtNC10LvQsNGC0Ywt0L7RgdGC0LDQstC70Y/RgtGMINC60LDQuiDQtdGB0YLRjC4g0K3RgtC+INC00LvRjyDQv9GA0LjQvNC10YDQsC4KICAgICAgICBpbWFnZV9maWxlID0gc3RyKGhhc2hNYXAuZ2V0KCJwaG90b19wYXRoIikpICMgItC/0LXRgNC10LzQtdC90L3QsNGPIisiX3BhdGgiIC0g0YHRjtC00LAg0L/QvtC80LXRidCw0LXRgtGB0Y8g0L/Rg9GC0Ywg0Log0L/QvtC70YPRh9C10L3QvdC+0Lkg0YTQvtGC0L7Qs9GA0LDRhNC40LgKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoaGFzaE1hcC5nZXQoInBob3RvX3BhdGgiKSkpIAoKICAgICAgICAj0YHRgNCw0LfRgyDRgdC00LXQu9Cw0LXQvCDRhNC+0YLQutGDIC0g0LrQstCw0LTRgNCw0YLQvdC+0LkgLSDRjdGC0L4g0L/RgNC+0YHRgtC+0Lkg0LLQsNGA0LjQsNC90YIuINCc0L7QttC90L4g0YHQtNC10LvQsNGC0Ywg0L3QsNC/0YDQuNC80LXRgCDQvtGC0LTQtdC70YzQviDQvNC40L3QuNCw0YLRjtGA0Ysg0LTQu9GPINGB0L/QuNGB0LrQsCwg0Y3RgtC+INC90LXQvNC90L7Qs9C+INGB0LvQvtC20L3QtdC1CiAgICAgICAgaW1hZ2UgPSBJbWFnZS5vcGVuKGltYWdlX2ZpbGUpCiAgICAgICAgaW0gPSBpbWFnZS5yZXNpemUoKDUwMCw1MDApKQogICAgICAgIGltLnNhdmUoaW1hZ2VfZmlsZSkKCiAgICAgICAganBob3RvYXJyID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgicGhvdG9HYWxsZXJ5IikpICAgIAogICAgICAgIGhhc2hNYXAucHV0KCJwaG90b0dhbGxlcnkiLGpzb24uZHVtcHMoanBob3RvYXJyKSkgICAgIAogICAgICAgICNoYXNoTWFwLnB1dCgidG9hc3QiLGpzb24uZHVtcHMoanBob3RvYXJyKSkgICAgIAogICAgICAgIAogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09ImdhbGxlcnlfY2hhbmdlIjogI9C/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQvNC+0LbQtdGCINGD0LTQsNC70LjRgtGMINGE0L7RgtC+INC40Lcg0LPQsNC70LXRgNC10LguINCd0L7QstGL0Lkg0LzQsNGB0YHQuNCyINC90LDQtNC+INC/0L7QvNC10YHRgtC40YLRjCDQuiDQtNC+0LrRg9C80LXQvdGC0YMKICAgICAgICAKCiAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgicGhvdG9HYWxsZXJ5Iik6ICAjINGN0YLQuCAyINC+0LHRgNCw0LHQvtGC0YfQuNC60LAgLSDQsNC90LDQu9C+0LPQuNGH0L3Ri9C1LCDQv9GA0L7RgdGC0L4g0LTQu9GPINGA0LDQt9C90YvRhSDRgdC+0LHRi9GC0LjQuQogICAgICAgICAgICBqcGhvdG9hcnIgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJwaG90b0dhbGxlcnkiKSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsanNvbi5kdW1wcyhqcGhvdG9hcnIpKSAgICAgIAogICAgICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IiwiIzIiK2pzb24uZHVtcHMoanBob3RvYXJyKSkgICAgIAoKICAgIHJldHVybiBoYXNoTWFwICAgIAoKICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t0K/Rh9C10LnQutC4ICAgCmRlZiBjZWxsc19vbl9zdGFydChoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgoKICAgIGxpc3QgPSB7ICJjdXN0b21jYXJkcyI6ICAgICAgICAgewogICAgICAgIAogICAgICAgICAgICAibGF5b3V0IjogewogICAgICAgICAgICAidHlwZSI6ICJMaW5lYXJMYXlvdXQiLAogICAgICAgICAgICAib3JpZW50YXRpb24iOiAidmVydGljYWwiLAogICAgICAgICAgICAiaGVpZ2h0IjogIm1hdGNoX3BhcmVudCIsCiAgICAgICAgICAgICJ3aWR0aCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAid2VpZ2h0IjogIjAiLAogICAgICAgICAgICAiRWxlbWVudHMiOiBbCiAgICAgICAgICAgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFsdWUiOiAiQGJhcmNvZGUiLAogICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZG9jdW1lbnRfdHlwZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAKICAgIH0KICAgIH0KICAgIAogICAgICAKCiAgICBxdWVyeSA9IHNlbGVjdChjIGZvciBjIGluIHVpX2dsb2JhbC5TV19DZWxscykKICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdPVtdCiAgICAKICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdLmFwcGVuZCh7Im5hbWUiOnJlY29yZC5uYW1lLCJrZXkiOnJlY29yZC5pZCwiYmFyY29kZSI6c3RyKHJlY29yZC5iYXJjb2RlKX0pICAgICAgICAgICAgICAgICAgICAgIAogICAgaGFzaE1hcC5wdXQoImxpc3QiLGpzb24uZHVtcHMobGlzdCkpCgogICAgcmV0dXJuIGhhc2hNYXAKCmRlZiBjZWxsc19pbnB1dChoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxfaWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09ImJ0bl9hZGQiOgogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIiwiIikKICAgICAgICBoYXNoTWFwLnB1dCgiYmFyY29kZSIsIiIpCiAgICAgICAgCiAgICAgICAgY2VsbF9pZD0tMQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0K/Rh9C10LnQutC40JfQsNC/0LjRgdGMIikKICAgICAgICAKICAgICAgCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iQ2FyZHNDbGljayI6ICAgIAogICAgICAgIAogICAgICAgIGpsaXN0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgibGlzdCIpKQogICAgICAgIGdvb2RzYXJyYXkgPSBqbGlzdFsiY3VzdG9tY2FyZHMiXVsnY2FyZHNkYXRhJ10KICAgICAgICAKICAgICAgICBqcmVjb3JkID0gbmV4dChpdGVtIGZvciBpdGVtIGluIGdvb2RzYXJyYXkgaWYgc3RyKGl0ZW1bImtleSJdKSA9PSBoYXNoTWFwLmdldCgic2VsZWN0ZWRfY2FyZF9rZXkiKSkKCiAgICAgICAgY2VsbF9pZCA9anJlY29yZFsna2V5J10KICAgICAgICBoYXNoTWFwLnB1dCgibmFtZSIsanJlY29yZFsnbmFtZSddKQogICAgICAgIGhhc2hNYXAucHV0KCJiYXJjb2RlIixqcmVjb3JkWydiYXJjb2RlJ10pCiAgICAgICAgICAgICAgICAgIAogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0K/Rh9C10LnQutC40JfQsNC/0LjRgdGMIikKICAgICAgICAKICAgIGVsaWYgIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0nT05fQkFDS19QUkVTU0VEJzogCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQnNC10L3RjiDQndCh0JgiKSAKCiAgICByZXR1cm4gaGFzaE1hcCAKCmRlZiBjZWxsc19yZWNvcmRfb25fc3RhcnQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKCiAgICBoYXNoTWFwLnB1dCgiZmlsbF9uYW1lIixqc29uLmR1bXBzKHsiaGludCI6ItCd0LDQuNC80LXQvdC+0LLQsNC90LjQtSIsImRlZmF1bHRfdGV4dCI6aGFzaE1hcC5nZXQoIm5hbWUiKX0pKQogICAgaGFzaE1hcC5wdXQoImZpbGxfYmFyY29kZSIsanNvbi5kdW1wcyh7ImhpbnQiOiLQqNGC0YDQuNGF0LrQvtC0IiwiZGVmYXVsdF90ZXh0IjpoYXNoTWFwLmdldCgiYmFyY29kZSIpfSkpCgogICAgcmV0dXJuIGhhc2hNYXAKCmRlZiBjZWxsc19yZWNvcmRfaW5wdXQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBjZWxsX2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJidG5fc2F2ZSI6CiAgICAgICAgI2hhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGNlbGxfaWQpKSAgICAgICAgIAoKICAgICAgICBpZiBub3QgaGFzaE1hcC5jb250YWluc0tleSgibmFtZSIpOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCLQndC1INGD0LrQsNC30LDQvdC+INC90LDQuNC80LXQvdC+0LLQsNC90LjQtSIpIAogICAgICAgICAgICByZXR1cm4gaGFzaE1hcCAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbGVuKGhhc2hNYXAuZ2V0KCJuYW1lIikpPT0wOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QtSDRg9C60LDQt9Cw0L3QviDQvdCw0LjQvNC10L3QvtCy0LDQvdC40LUiKSAKICAgICAgICAgICAgICAgIHJldHVybiBoYXNoTWFwICAKCiAgICAgICAgaWYgY2VsbF9pZDwwOgogICAgICAgICAgICAKCiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfQ2VsbHMobmFtZT1nZXRfaWZfZXhpc3QoaGFzaE1hcCwibmFtZSIpLGJhcmNvZGU9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsImJhcmNvZGUiKSkKICAgICAgICAgICAgICAgIGNvbW1pdCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0NlbGxzW2NlbGxfaWRdCiAgICAgICAgICAgICAgICByLm5hbWUgPSBnZXRfaWZfZXhpc3QoaGFzaE1hcCwibmFtZSIpCiAgICAgICAgICAgICAgICByLmJhcmNvZGUgPSBnZXRfaWZfZXhpc3QoaGFzaE1hcCwiYmFyY29kZSIpCiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29tbWl0KCkKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCv0YfQtdC50LrQuCIpIAoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJiYXJjb2RlIjoKICAgICAgICBoYXNoTWFwLnB1dCgiYmFyY29kZSIsaGFzaE1hcC5nZXQoImJhcmNvZGVfY2VsbCIpKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJDYXJkc0NsaWNrIjoKICAgICAgICBhPVRydWUKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoaGFzaE1hcC5nZXQoInNlbGVjdGVkX2NhcmRfa2V5IikpKQoKICAgIGVsaWYgIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0nT05fQkFDS19QUkVTU0VEJzogCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQnNC10L3RjiDQndCh0JgiKSAKICAgIGVsaWYgIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0nbWVudV9kZWwnOiAKICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfQ2VsbHNbY2VsbF9pZF0gCiAgICAgICAgICAgIHIuZGVsZXRlKCkKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCv0YfQtdC50LrQuCIpICAKICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCLQo9C00LDQu9C10L3Qvi4uLiIpICAKCiAgICByZXR1cm4gaGFzaE1hcCAgICAgICAgCgoKZGVmIGluY29tZV9jZWxsX29uX3N0YXJ0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICAKICAgIGp0ID17CiAgICAidHlwZSI6ICJ0YWJsZSIsCiAgICAidGV4dHNpemUiOiAiMjUiLAogICAgImhpZGVjYXB0aW9uIjogImZhbHNlIiwKICAgICJoaWRlaW50ZXJsaW5lIjogImZhbHNlIiwKICAgICJjb2x1bW5zIjogWwogICAgewogICAgICAgICJuYW1lIjogImNlbGwiLAogICAgICAgICJoZWFkZXIiOiAi0K/Rh9C10LnQutCwIiwKICAgICAgICAid2VpZ2h0IjogIjEiCiAgICB9LAogICAgewogICAgICAgICJuYW1lIjogIm5vbSIsCiAgICAgICAgImhlYWRlciI6ICLQotC+0LLQsNGAIiwKICAgICAgICAid2VpZ2h0IjogIjIiCiAgICB9LAogICAgewogICAgICAgICJuYW1lIjogInF0eSIsCiAgICAgICAgImhlYWRlciI6ICLQmtC+0Lst0LLQviIsCiAgICAgICAgIndlaWdodCI6ICIxIgogICAgfQogICAgXSwKICAgICJyb3dzIjogW10KICAgIH0KCiAgICBpZiBub3QgaGFzaE1hcC5jb250YWluc0tleSgicGYiKToKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QvtCy0YvQuSIpCiAgICAgICAgaGFzaE1hcC5wdXQoInBmIiwiMSIpICPRhNC70LDQsyDQtNC70Y8g0L7Qv9GA0LXQtNC10LvQtdC90LjRjyDQvdCw0YfQsNC70LAg0L/RgNC+0YbQtdGB0YHQsAogICAgICAgIGhhc2hNYXAucHV0KCJjZW50cmFsX3RhYmxlIixqc29uLmR1bXBzKGp0KSkKCiAgICAKICAgIGNlbGxzID0gW10KICAgIGNlbGxzLmFwcGVuZCgiPNCy0YvQsdC10YDQuNGC0LUg0Y/Rh9C10LnQutGDLi4uPiIpCiAgICBxdWVyeSA9IHNlbGVjdChjIGZvciBjIGluIHVpX2dsb2JhbC5TV19DZWxscykKICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgY2VsbHMuYXBwZW5kKHJlY29yZC5uYW1lKQoKICAgIGhhc2hNYXAucHV0KCJjZWxscyIsIjsiLmpvaW4oY2VsbHMpKQoKICAgIHJldHVybiBoYXNoTWFwICAgIAoKZGVmIGluY29tZV9jZWxsX29uX2lucHV0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICAKICAgICNoYXNoTWFwLnB1dCgidG9hc3QiLGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpKQoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iIjoKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0Iiwi0JLRi9Cx0L7RgCDRgtC+0LLQsNGA0LAtLSIpIAoKICAgICAgICBpZiBub3QgaGFzaE1hcC5jb250YWluc0tleSgiY2VsbCIpOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCLQndC1INGD0LrQsNC30LDQvdCwINGP0YfQtdC50LrQsCIpIAogICAgICAgICAgICByZXR1cm4gaGFzaE1hcCAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbGVuKGhhc2hNYXAuZ2V0KCJjZWxsIikpPT0wOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QtSDRg9C60LDQt9Cw0L3QsCDRj9GH0LXQudC60LAiKSAKICAgICAgICAgICAgICAgIHJldHVybiBoYXNoTWFwICAKCiAgICAgICAgCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQktGL0LHQvtGAINGC0L7QstCw0YDQsCIpIAoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJiYXJjb2RlIjoKCiAgICAgICAgY2VsbCA9IHVpX2dsb2JhbC5TV19DZWxscy5nZXQoYmFyY29kZT1oYXNoTWFwLmdldCgiYmFyY29kZV9jZWxsIikpCiAgICAgICAgaWYgY2VsbD09Tm9uZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0K/Rh9C10LnQutCwINC90LUg0L3QsNC50LTQtdC90LAiKQogICAgICAgIGVsc2U6ICAgIAogICAgICAgICAgICBoYXNoTWFwLnB1dCgiY2VsbCIsY2VsbC5uYW1lKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiY2VsbF9pZCIsc3RyKGNlbGwuaWQpKQoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQktGL0LHQvtGAINGC0L7QstCw0YDQsCIpCgogICAgZWxpZiAgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSdjZWxsJzogCiAgICAgICAgY2VsbCA9IHVpX2dsb2JhbC5TV19DZWxscy5nZXQobmFtZT1oYXNoTWFwLmdldCgiY2VsbCIpKQogICAgICAgIGlmIGNlbGw9PU5vbmU6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCv0YfQtdC50LrQsCDQvdC1INC90LDQudC00LXQvdCwIikKICAgICAgICBlbHNlOiAgICAKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImNlbGwiLGNlbGwubmFtZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImNlbGxfaWQiLHN0cihjZWxsLmlkKSkKCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0JLRi9Cx0L7RgCDRgtC+0LLQsNGA0LAiKSAgCgoKICAgIHJldHVybiBoYXNoTWFwICAgICAgICAKCmRlZiBpbmNvbWVfbm9tX2lucHV0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICAjaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgibGlzdGVuZXIiKSkKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09IiI6CiAgICAgICAgCgogICAgICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KCJub20iKToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QtSDRg9C60LDQt9Cw0L0g0YLQvtCy0LDRgCIpIAogICAgICAgICAgICByZXR1cm4gaGFzaE1hcCAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbGVuKGhhc2hNYXAuZ2V0KCJjZWxsIikpPT0wOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QtSDRg9C60LDQt9Cw0L0g0YLQvtCy0LDRgCIpIAogICAgICAgICAgICAgICAgcmV0dXJuIGhhc2hNYXAgIAoKICAgICAgICAKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCS0LLQvtC0INC60L7Qu9C40YfQtdGB0YLQstCwIikgCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iQkFDS19CVVRUT04iOgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0JLRi9Cx0L7RgCDRj9GH0LXQudC60LgiKQogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09ImJhcmNvZGUiOgoKICAgICAgICBub20gPSB1aV9nbG9iYWwuU1dfR29vZHMuZ2V0KGJhcmNvZGU9aGFzaE1hcC5nZXQoImJhcmNvZGUiKSkKICAgICAgICBpZiBub209PU5vbmU6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCi0L7QstCw0YAg0L3QtSDQvdCw0LnQtNC10L0iKQogICAgICAgIGVsc2U6ICAgIAogICAgICAgICAgICBoYXNoTWFwLnB1dCgibm9tIixub20ubmFtZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm5vbV9pZCIsc3RyKG5vbS5pZCkpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJzcGVhayIsbm9tLm5hbWUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0JLQstC+0LQg0LrQvtC70LjRh9C10YHRgtCy0LAiKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgicXR5IiwiMSIpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09InZpc2lvbiI6CiAgICAgICAgICAgICNoYXNoTWFwLnB1dCgidG9hc3QiLGhhc2hNYXAuZ2V0KCJub21faWQiKSkKICAgICAgICAgICAgbm9tID0gdWlfZ2xvYmFsLlNXX0dvb2RzLmdldChpZD1pbnQoaGFzaE1hcC5nZXQoIm5vbV9pZCIpKSkKICAgICAgICAgICAgaWYgbm9tPT1Ob25lOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0KLQvtCy0LDRgCDQvdC1INC90LDQudC00LXQvSIpCiAgICAgICAgICAgIGVsc2U6ICAgIAogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm5vbSIsbm9tLm5hbWUpCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgibm9tX2lkIixzdHIobm9tLmlkKSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJzcGVhayIsbm9tLm5hbWUpCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCS0LLQvtC0INC60L7Qu9C40YfQtdGB0YLQstCwIikKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJxdHkiLCIxIikKCiAgICByZXR1cm4gaGFzaE1hcCAgCgoKCmRlZiBpbmNvbWVfcXR5X2lucHV0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICAKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09IiI6CiAgICAgICAgCgogICAgICAgIGlmIGdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsInF0eSIpPjA6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfQWNjb3VudChxdHk9Z2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwicXR5Iiksc2t1PWludChoYXNoTWFwLmdldCgibm9tX2lkIikpLGNlbGw9aW50KGhhc2hNYXAuZ2V0KCJjZWxsX2lkIikpKQogICAgICAgICAgICAgICAgY29tbWl0KCkKCiAgICAgICAgICAgICAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCd0LUg0YPQutCw0LfQsNC90L4g0LrQvtC7LdCy0L4iKSAKICAgICAgICAgICAgcmV0dXJuIGhhc2hNYXAgIAoKICAgIGp0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgiY2VudHJhbF90YWJsZSIpKQogICAganRbJ3Jvd3MnXS5hcHBlbmQoeyJjZWxsIjpoYXNoTWFwLmdldCgiY2VsbCIpLCJub20iOmhhc2hNYXAuZ2V0KCJub20iKSwicXR5IjpoYXNoTWFwLmdldCgicXR5Iil9KQoKICAgIGhhc2hNYXAucHV0KCJjZW50cmFsX3RhYmxlIixqc29uLmR1bXBzKGp0KSkKCiAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCS0YvQsdC+0YAg0YLQvtCy0LDRgNCwIikgICAgCiAgICAgICAgICAgIAogICAgcmV0dXJuIGhhc2hNYXAgCiAgICAgICAgCgpkZWYgb3V0Y29tZV9xdHlfaW5wdXQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iIjoKICAgICAgICAKCiAgICAgICAgaWYgZ2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwicXR5Iik+MDoKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19BY2NvdW50KHF0eT0tMSpnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCJxdHkiKSxza3U9aW50KGhhc2hNYXAuZ2V0KCJub21faWQiKSksY2VsbD1pbnQoaGFzaE1hcC5nZXQoImNlbGxfaWQiKSkpCiAgICAgICAgICAgICAgICBjb21taXQoKQoKICAgICAgICAgICAgICAKICAgICAgICBlbHNlOgogICAgICAgICAgICAKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QtSDRg9C60LDQt9Cw0L3QviDQutC+0Lst0LLQviIpIAogICAgICAgICAgICByZXR1cm4gaGFzaE1hcCAgCgogICAganQgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJjZW50cmFsX3RhYmxlIikpCiAgICBqdFsncm93cyddLmFwcGVuZCh7ImNlbGwiOmhhc2hNYXAuZ2V0KCJjZWxsIiksIm5vbSI6aGFzaE1hcC5nZXQoIm5vbSIpLCJxdHkiOmhhc2hNYXAuZ2V0KCJxdHkiKX0pCgogICAgaGFzaE1hcC5wdXQoImNlbnRyYWxfdGFibGUiLGpzb24uZHVtcHMoanQpKQoKICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0JLRi9Cx0L7RgCDRgtC+0LLQsNGA0LAiKSAgICAKICAgICAgICAgICAgCiAgICByZXR1cm4gaGFzaE1hcCAgICAgICAgIAoKZGVmIHN0b2NrX29uX2NyZWF0ZShoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgoKICAgIHRhYmxlICA9IHsKICAgICJ0eXBlIjogInRhYmxlIiwKICAgICJ0ZXh0c2l6ZSI6ICIxNyIsCgogICAgImNvbHVtbnMiOiBbCiAgICB7CiAgICAgICAgIm5hbWUiOiAiY2VsbCIsCiAgICAgICAgImhlYWRlciI6ICLQr9GH0LXQudC60LAiLAogICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgIH0sCiAgICB7CiAgICAgICAgIm5hbWUiOiAibm9tIiwKICAgICAgICAiaGVhZGVyIjogItCi0L7QstCw0YAiLAogICAgICAgICJ3ZWlnaHQiOiAiMiIKICAgIH0sCiAgICB7CiAgICAgICAgIm5hbWUiOiAicXR5IiwKICAgICAgICAiaGVhZGVyIjogItCe0YHRgtCw0YLQvtC6IiwKICAgICAgICAid2VpZ2h0IjogIjEiCiAgICB9CiAgICBdCiAgICB9CgogICAgY29ubj0gTm9uZQogICAgdHJ5OgogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJy8vZGF0YS9kYXRhL3J1LnRyYXZlbGZvb2Quc2ltcGxlX3VpL2RhdGFiYXNlcy9TaW1wbGVXTVMnKQogICAgZXhjZXB0IEVycm9yIGFzIGU6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcign0J3QtdGCINGB0L7QtdC00LjQvdC10L3QuNGPINGBINCx0LDQt9C+0LkhJykKCiAgICAKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgU1dfQ2VsbHMubmFtZSBhcyBjZWxsLFNXX0dvb2RzLm5hbWUgYXMgbm9tLCBpZm51bGwoc3VtKHF0eSksMCkgYXMgcXR5IEZST00gU1dfQWNjb3VudCBMRUZUIEpPSU4gU1dfR29vZHMgT04gU1dfQWNjb3VudC5za3U9U1dfR29vZHMuaWQgTEVGVCBKT0lOIFNXX0NlbGxzIE9OIFNXX0FjY291bnQuY2VsbD1TV19DZWxscy5pZCBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lIEhBVklORyBpZm51bGwoc3VtKHF0eSksMCk8PjAiKQoKICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgIHJvd3M9W10KICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICByb3dzLmFwcGVuZCh7ImNlbGwiOnJlY29yZFswXSwibm9tIjpyZWNvcmRbMV0sInF0eSI6cmVjb3JkWzJdfSkKCiAgICB0YWJsZVsncm93cyddID1yb3dzICAgCiAgICBoYXNoTWFwLnB1dCgidGFibGUiLGpzb24uZHVtcHModGFibGUpKQoKICAgIHJldHVybiBoYXNoTWFwIAoKCmRlZiBnZXRfdGFibGVfYnlfY2VsbChpZCk6CiAgICB0YWJsZSAgPSB7CiAgICAidHlwZSI6ICJ0YWJsZSIsCiAgICAidGV4dHNpemUiOiAiMTciLAoKICAgICJjb2x1bW5zIjogWwogICAgewogICAgICAgICJuYW1lIjogImNlbGwiLAogICAgICAgICJoZWFkZXIiOiAi0K/Rh9C10LnQutCwIiwKICAgICAgICAid2VpZ2h0IjogIjEiCiAgICB9LAogICAgewogICAgICAgICJuYW1lIjogIm5vbSIsCiAgICAgICAgImhlYWRlciI6ICLQotC+0LLQsNGAIiwKICAgICAgICAid2VpZ2h0IjogIjIiCiAgICB9LAogICAgewogICAgICAgICJuYW1lIjogInF0eSIsCiAgICAgICAgImhlYWRlciI6ICLQntGB0YLQsNGC0L7QuiIsCiAgICAgICAgIndlaWdodCI6ICIxIgogICAgfQogICAgXQogICAgfQoKICAgIGNvbm49IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCcvL2RhdGEvZGF0YS9ydS50cmF2ZWxmb29kLnNpbXBsZV91aS9kYXRhYmFzZXMvU2ltcGxlV01TJykKICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ9Cd0LXRgiDRgdC+0LXQtNC40L3QtdC90LjRjyDRgSDQsdCw0LfQvtC5IScpCgogICAgCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIFNXX0NlbGxzLm5hbWUgYXMgY2VsbCxTV19Hb29kcy5uYW1lIGFzIG5vbSwgaWZudWxsKHN1bShxdHkpLDApIGFzIHF0eSBGUk9NIFNXX0FjY291bnQgTEVGVCBKT0lOIFNXX0dvb2RzIE9OIFNXX0FjY291bnQuc2t1PVNXX0dvb2RzLmlkIExFRlQgSk9JTiBTV19DZWxscyBPTiBTV19BY2NvdW50LmNlbGw9U1dfQ2VsbHMuaWQgV0hFUkUgU1dfQWNjb3VudC5jZWxsID0gIiArc3RyKGlkKSsgIiBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lIEhBVklORyBpZm51bGwoc3VtKHF0eSksMCk8PjAiKQoKICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgIHJvd3M9W10KICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICByb3dzLmFwcGVuZCh7ImNlbGwiOnJlY29yZFswXSwibm9tIjpyZWNvcmRbMV0sInF0eSI6cmVjb3JkWzJdfSkKCiAgICB0YWJsZVsncm93cyddID1yb3dzICAgCiAgIAoKICAgIHJldHVybiBqc29uLmR1bXBzKHRhYmxlKSAgICAgIAoKZGVmIGdldF90YWJsZV9ieV9ub20oaWQpOgogICAgdGFibGUgID0gewogICAgInR5cGUiOiAidGFibGUiLAogICAgInRleHRzaXplIjogIjE3IiwKCiAgICAiY29sdW1ucyI6IFsKICAgIHsKICAgICAgICAibmFtZSI6ICJjZWxsIiwKICAgICAgICAiaGVhZGVyIjogItCv0YfQtdC50LrQsCIsCiAgICAgICAgIndlaWdodCI6ICIxIgogICAgfSwKICAgIHsKICAgICAgICAibmFtZSI6ICJub20iLAogICAgICAgICJoZWFkZXIiOiAi0KLQvtCy0LDRgCIsCiAgICAgICAgIndlaWdodCI6ICIyIgogICAgfSwKICAgIHsKICAgICAgICAibmFtZSI6ICJxdHkiLAogICAgICAgICJoZWFkZXIiOiAi0J7RgdGC0LDRgtC+0LoiLAogICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgIH0KICAgIF0KICAgIH0KCiAgICBjb25uPSBOb25lCiAgICB0cnk6CiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgnLy9kYXRhL2RhdGEvcnUudHJhdmVsZm9vZC5zaW1wbGVfdWkvZGF0YWJhc2VzL1NpbXBsZVdNUycpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQoKICAgIAogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBTV19DZWxscy5uYW1lIGFzIGNlbGwsU1dfR29vZHMubmFtZSBhcyBub20sIGlmbnVsbChzdW0ocXR5KSwwKSBhcyBxdHkgRlJPTSBTV19BY2NvdW50IExFRlQgSk9JTiBTV19Hb29kcyBPTiBTV19BY2NvdW50LnNrdT1TV19Hb29kcy5pZCBMRUZUIEpPSU4gU1dfQ2VsbHMgT04gU1dfQWNjb3VudC5jZWxsPVNXX0NlbGxzLmlkIFdIRVJFIFNXX0FjY291bnQuc2t1ID0gIiArc3RyKGlkKSsgIiBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lIEhBVklORyBpZm51bGwoc3VtKHF0eSksMCk8PjAiKQoKICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgIHJvd3M9W10KICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICByb3dzLmFwcGVuZCh7ImNlbGwiOnJlY29yZFswXSwibm9tIjpyZWNvcmRbMV0sInF0eSI6cmVjb3JkWzJdfSkKCiAgICB0YWJsZVsncm93cyddID1yb3dzICAgCiAgIAoKICAgIHJldHVybiBqc29uLmR1bXBzKHRhYmxlKSAgICAgIAoKZGVmIHN0b2NrX2lucHV0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICAKCiAgICBpZiAgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJiYXJjb2RlIjoKCiAgICAgICAgbm9tID0gdWlfZ2xvYmFsLlNXX0dvb2RzLmdldChiYXJjb2RlPWhhc2hNYXAuZ2V0KCJiYXJjb2RlIikpCiAgICAgICAgaXNfbm9tPUZhbHNlCiAgICAgICAgCgogICAgICAgIAogICAgICAgIG9iamVjdD0iIgoKICAgICAgICBpZiBub209PU5vbmU6CiAgICAgICAgICAgIGlzX25vbT1GYWxzZQogICAgICAgIGVsc2U6ICAgCiAgICAgICAgICAgIGlzX25vbT1UcnVlIAogICAgICAgICAgICBoYXNoTWFwLnB1dCgib2JqZWN0Iixub20ubmFtZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRhYmxlX29iamVjdCIsZ2V0X3RhYmxlX2J5X25vbShub20uaWQpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCe0YHRgtCw0YLQutC4INC/0L4g0L7QsdGK0LXQutGC0YMiKQoKICAgICAgICBpZiAgbm90IGlzX25vbToKICAgICAgICAgICAgY2VsbCA9IHVpX2dsb2JhbC5TV19DZWxscy5nZXQoYmFyY29kZT1oYXNoTWFwLmdldCgiYmFyY29kZSIpKQogICAgICAgICAgICBpZiBjZWxsPT1Ob25lOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0KjRgtGA0LjRhdC60L7QtCDQvdC4INGP0YfQtdC50LrQuCDQvdC4INGC0L7QsNGA0LAiKQogICAgICAgICAgICBlbHNlOiAgICAKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJvYmplY3QiLGNlbGwubmFtZSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0YWJsZV9vYmplY3QiLGdldF90YWJsZV9ieV9jZWxsKGNlbGwuaWQpKSAgCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsItCe0YHRgtCw0YLQutC4INC/0L4g0L7QsdGK0LXQutGC0YMiKQoKICAgICAgIAogICAgICAgICAgICAKICAgIHJldHVybiBoYXNoTWFwICAKCmRlZiBzdG9ja19vYmplY3RfaW5wdXQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09IkJBQ0tfQlVUVE9OIjoKICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQntGB0YLQsNGC0LrQuCIpICAgIAoKICAgIHJldHVybiBoYXNoTWFwICAgICAKCmRlZiBpbnZlbnRvcnlfb25fc3RhcnQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKCiAgICBsaXN0ID0geyAiY3VzdG9tY2FyZHMiOiAgICAgICAgIHsKICAgICAgICAKICAgICAgICAgICAgImxheW91dCI6IHsKICAgICAgICAgICAgInR5cGUiOiAiTGluZWFyTGF5b3V0IiwKICAgICAgICAgICAgIm9yaWVudGF0aW9uIjogInZlcnRpY2FsIiwKICAgICAgICAgICAgImhlaWdodCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAid2lkdGgiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgIndlaWdodCI6ICIwIiwKICAgICAgICAgICAgIkVsZW1lbnRzIjogWwogICAgICAgICAgIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFsdWUiOiAiQGRlc2NyIiwKICAgICAgICAgICAgICAgICAgICAiTm9SZWZyZXNoIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImRvY3VtZW50X3R5cGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibWFzayI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYXJpYWJsZSI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfQogICAgICAgIAogICAgfQogICAgfQogICAgCiAgICAgIAoKICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0ludmVudG9yeSkKICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdPVtdCiAgICAKICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdLmFwcGVuZCh7ImRlc2NyIjpyZWNvcmQuZGVzY3JpcHRpb24sImtleSI6cmVjb3JkLmlkLCJkYXRlIjpzdHIocmVjb3JkLmNyZWF0ZWRfYXQpfSkgICAgICAgICAgICAgICAgICAgICAgCiAgICBoYXNoTWFwLnB1dCgiaW52ZW50b3J5Iixqc29uLmR1bXBzKGxpc3QpKQoKICAgIHJldHVybiBoYXNoTWFwCgpkZWYgaW52ZW50b3J5X2lucHV0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbF9pZAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iYnRuX25ldyI6CiAgICAgICAgICAgICAgIAogICAgICAgIAogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwi0J3QvtCy0LDRjyDQuNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPIikKICAgICAgICAKICAgICAgCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iQ2FyZHNDbGljayI6ICAgIAogICAgICAgIAogICAgICAgIGpsaXN0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgiaW52ZW50b3J5IikpCiAgICAgICAgZ29vZHNhcnJheSA9IGpsaXN0WyJjdXN0b21jYXJkcyJdWydjYXJkc2RhdGEnXQogICAgICAgIAogICAgICAgIGpyZWNvcmQgPSBuZXh0KGl0ZW0gZm9yIGl0ZW0gaW4gZ29vZHNhcnJheSBpZiBzdHIoaXRlbVsia2V5Il0pID09IGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9jYXJkX2tleSIpKQoKICAgICAgICBpbnZfaWQgPWpyZWNvcmRbJ2tleSddCiAgICAgICAgaGFzaE1hcC5wdXQoImludl9uYW1lIixqcmVjb3JkWydkZXNjciddKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnZfaWQiLHN0cihpbnZfaWQpKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnZfZGF0ZSIsc3RyKGpyZWNvcmRbJ2RhdGUnXSkpCiAgICAgICAKICAgICAgICAgICAgICAgICAgCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPINCg0LXQt9GD0LvRjNGC0LDRgtGLIikKICAgICAgICAKICAgIAoKICAgIHJldHVybiBoYXNoTWFwIAoKZGVmIG5ld2ludl9pbnB1dChoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxfaWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09IiI6CiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19JbnZlbnRvcnkoZGVzY3JpcHRpb249aGFzaE1hcC5nZXQoJ25hbWUnKSkKICAgICAgICAgICAgICAgIGNvbW1pdCgpICAgCgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludl9uYW1lIixoYXNoTWFwLmdldCgnbmFtZScpKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludl9pZCIsc3RyKHIuaWQpKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludl9kYXRlIixzdHIoci5jcmVhdGVkX2F0KSkgICAgCiAgICAgICAgICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoci5pZCkpCgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPINCg0LXQt9GD0LvRjNGC0LDRgtGLIikKICAgICAgICAKICAgIAoKICAgIHJldHVybiBoYXNoTWFwIAoKZGVmIGludnJlc19vbl9zdGFydChoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgogICAgCgogICAgaW52ZGF0ZSA9IGRhdGV0aW1lLmZyb21pc29mb3JtYXQoc3RyKGhhc2hNYXAuZ2V0KCJpbnZfZGF0ZSIpKSkKICAgIGhhc2hNYXAucHV0KCJpbnYiLCLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIrc3RyKGhhc2hNYXAuZ2V0KCJpbnZfbmFtZSIpKSsiINC+0YIgIitpbnZkYXRlLnN0cmZ0aW1lKCIlbS4lZC4lWSwgJUg6JU06JVMiKSkKCgogICAgdGFibGUgID0gewogICAgInR5cGUiOiAidGFibGUiLAogICAgInRleHRzaXplIjogIjE3IiwKCiAgICAiY29sdW1ucyI6IFsKICAgIHsKICAgICAgICAibmFtZSI6ICJjZWxsIiwKICAgICAgICAiaGVhZGVyIjogItCv0YfQtdC50LrQsCIsCiAgICAgICAgIndlaWdodCI6ICIxIgogICAgfSwKICAgIHsKICAgICAgICAibmFtZSI6ICJub20iLAogICAgICAgICJoZWFkZXIiOiAi0KLQvtCy0LDRgCIsCiAgICAgICAgIndlaWdodCI6ICIyIgogICAgfSwKICAgIHsKICAgICAgICAibmFtZSI6ICJxdHlwbGFuIiwKICAgICAgICAiaGVhZGVyIjogItCf0LvQsNC9IiwKICAgICAgICAid2VpZ2h0IjogIjEiCiAgICB9LAogICAgewogICAgICAgICJuYW1lIjogInF0eWZhY3QiLAogICAgICAgICJoZWFkZXIiOiAi0KTQsNC60YIiLAogICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgIH0KICAgIF0KICAgIH0KCiAgICBjb25uPSBOb25lCiAgICB0cnk6CiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgnLy9kYXRhL2RhdGEvcnUudHJhdmVsZm9vZC5zaW1wbGVfdWkvZGF0YWJhc2VzL1NpbXBsZVdNUycpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQoKICAgIAogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoInNlbGVjdCBULmNlbGwsVC5ub20sbWF4KFQucXR5cGxhbikgYXMgcXR5cGxhbiwgaWZudWxsKHN1bShGLnF0eSksMCkgYXMgcXR5ZmFjdCBGUk9NIChTRUxFQ1QgU1dfQ2VsbHMubmFtZSBhcyBjZWxsLFNXX0dvb2RzLm5hbWUgYXMgbm9tLCBpZm51bGwoc3VtKFNXX0FjY291bnQucXR5KSwwKSBhcyBxdHlwbGFuLFNXX0FjY291bnQuc2t1IGFzIHNrdWlkLCBTV19BY2NvdW50LmNlbGwgYXMgY2VsbGlkIEZST00gU1dfQWNjb3VudCBMRUZUIEpPSU4gU1dfR29vZHMgT04gU1dfQWNjb3VudC5za3U9U1dfR29vZHMuaWQgTEVGVCBKT0lOIFNXX0NlbGxzIE9OIFNXX0FjY291bnQuY2VsbD1TV19DZWxscy5pZCAgIEdST1VQIEJZIFNXX0dvb2RzLm5hbWUgLFNXX0NlbGxzLm5hbWUsIFNXX0FjY291bnQuY2VsbCwgU1dfQWNjb3VudC5za3UgSEFWSU5HIGlmbnVsbChzdW0oU1dfQWNjb3VudC5xdHkpLDApPD4wKSBhcyBUIExFRlQgSk9JTiBTV19JbnZlbnRvcnlfbGluZSBBUyBGIE9OIFQuY2VsbGlkPUYuY2VsbCBBTkQgVC5za3VpZD1GIC5za3UgYW5kIEYgLmludmVudG9yeT0iK2hhc2hNYXAuZ2V0KCJpbnZfaWQiKSsiIEdST1VQIEJZIFQuY2VsbCxULm5vbSIpCgogICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgcm93cz1bXQogICAgY29sb3JjZWxscz1bXQogICAgcm93PTAKICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICAKICAgICAgICByb3dzLmFwcGVuZCh7ImNlbGwiOnJlY29yZFswXSwibm9tIjpyZWNvcmRbMV0sInF0eXBsYW4iOnJlY29yZFsyXSwicXR5ZmFjdCI6cmVjb3JkWzNdfSkKICAgICAgICAj0L/QvtC00LrRgNCw0YjQuNCy0LDQtdC8INGA0LXQt9GD0LvRjNGC0LDRgtGLINCyINC30LXQu9C10L3Ri9C5INC4INC60YDQsNGB0L3Ri9C5INGG0LLQtdGC0LAKICAgICAgICBpZiByZWNvcmRbM10+MDoKICAgICAgICAgICAgaWYgcmVjb3JkWzNdPj1yZWNvcmRbMl06CiAgICAgICAgICAgICAgIGNvbG9yY2VsbHMuYXBwZW5kKHsicm93Ijogcm93LCJjb2x1bW4iOiAiMyIsImNvbG9yIjogIiMzMmE4NTIiIH0pIAogICAgICAgICAgICBlbHNlOiAgCiAgICAgICAgICAgICAgIGNvbG9yY2VsbHMuYXBwZW5kKHsicm93Ijogcm93LCJjb2x1bW4iOiAiMyIsImNvbG9yIjogIiNlNjRjNGMiIH0pICAgCiAgICAgICAgcm93Kz0xCgoKICAgIHRhYmxlWydyb3dzJ10gPXJvd3MgCiAgICB0YWJsZVsnY29sb3JjZWxscyddID1jb2xvcmNlbGxzICAKCgoKICAgIGhhc2hNYXAucHV0KCJ0YWJsZSIsanNvbi5kdW1wcyh0YWJsZSkpICAgICAgICAgICAgCiAgICAgICAgCiAgICAKCiAgICByZXR1cm4gaGFzaE1hcCAKCmRlZiBpbnZyZXNfaW5wdXQoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBjZWxsX2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSJidG5fcnVuIjoKICAgICAgICBoYXNoTWFwLnB1dCgiUnVuQ1YiLCLQmNC90LJDViIpCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09ImJ0bl9ydW5fb2NyIjoKICAgICAgICBoYXNoTWFwLnB1dCgiUnVuQ1YiLCLQmNC90LJDVk9DUiIpICAgIAogICAgICAgIAogICAgCgogICAgcmV0dXJuIGhhc2hNYXAKCmRlZiBpbnZyZXNfaW5wdXRfb2NyKGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbF9pZAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpPT0iYnRuX3J1biI6CiAgICAgICAgaGFzaE1hcC5wdXQoIlJ1bkNWIiwi0JjQvdCyQ1YiKQogICAgICAgIAogICAgCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgaW52Y3ZfY2VsbF9vbl9zdGFydChoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxzCiAgICBnbG9iYWwgY2VsbGlkCgogICAgY2VsbGlkPU5vbmUKCiAgICAKCiAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCJzdG9wX2xpc3RlbmVyX2xpc3QiKToKICAgICAgICBoYXNoTWFwLnJlbW92ZSgic3RvcF9saXN0ZW5lcl9saXN0IikKICAgIAogICAgI2NyZWF0ZSBjb25uZWN0aW9uIHdpdGggZGF0YWJhc2UKICAgIGNvbm49IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCcvL2RhdGEvZGF0YS9ydS50cmF2ZWxmb29kLnNpbXBsZV91aS9kYXRhYmFzZXMvU2ltcGxlV01TJykKICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ9Cd0LXRgiDRgdC+0LXQtNC40L3QtdC90LjRjyDRgSDQsdCw0LfQvtC5IScpCiAgCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGJhcmNvZGUsaWQsbmFtZSBGUk9NIFNXX0NlbGxzIikKCiAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKCiAgICBncmVlbl9saXN0ID0gW10KICAgIHJlZF9saXN0PSBbXQogICAgaW5mb19saXN0ID0gW10KICAgIGNlbGxzPXt9CiAgICBmb3IgbGluayBpbiByZXN1bHRzOgogICAgICAgICNqb2IgPSB7Im9iamVjdCI6c3RyKGxpbmtbMF0pLCJpbmZvIjpzdHIobGlua1sxXSkrIiA8L24+INCe0YHRgtCw0YLQvtC6OiA8YmlnPiIrc3RyKGxpbmtbMl0pKyI8L2JpZz4ifQogICAgICAgICNpbmZvX2xpc3QuYXBwZW5kKGpvYikKICAgICAgICBncmVlbl9saXN0LmFwcGVuZChsaW5rWzBdKQogICAgICAgIGNlbGxzW2xpbmtbMF1dPWxpbmtbMV0gICAKICAgICAgICAgICAgCiAgICBjb25uLmNsb3NlKCkgICAgIAoKICAgICNoYXNoTWFwLnB1dCgib2JqZWN0X2luZm9fbGlzdCIsanNvbi5kdW1wcyhpbmZvX2xpc3QsZW5zdXJlX2FzY2lpPUZhbHNlKSkKICAgIGhhc2hNYXAucHV0KCJncmVlbl9saXN0IiwnOycuam9pbihncmVlbl9saXN0KSkKICAgIAogICAgcmV0dXJuIGhhc2hNYXAgCgpkZWYgaW52Y3ZfY2VsbF9vbl9uZXdfb2JqZWN0X29jcihoYXNoTWFwLF9maWxlcz1Ob25lLF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxzCiAgICBnbG9iYWwgY2VsbGlkCgogICAgCiAgICBoYXNoTWFwLnB1dCgidmlicmF0ZSIsIiIpCgogICAgY2VsbGlkPWNlbGxzLmdldChoYXNoTWFwLmdldCgiY3VycmVudF9vYmplY3QiKSkKCiAgICBpZiBub3QgY2VsbGlkPT1Ob25lOgogICAgCiAgICAgICAgI2NyZWF0ZSBjb25uZWN0aW9uIHdpdGggZGF0YWJhc2UKICAgICAgICBjb25uPSBOb25lCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCcvL2RhdGEvZGF0YS9ydS50cmF2ZWxmb29kLnNpbXBsZV91aS9kYXRhYmFzZXMvU2ltcGxlV01TJykKICAgICAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcign0J3QtdGCINGB0L7QtdC00LjQvdC10L3QuNGPINGBINCx0LDQt9C+0LkhJykKICAgIAogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgICMg0YLRg9GCINGPINC/0L7QvdGP0Lsg0YfRgtC+INC70LDQttCw0L3Rg9C70YHRjywg0LjRgdC/0L7Qu9GM0LfQvtCy0LDQsiB1bmlxdWUg0LIg0LrQsNGH0LXRgdGC0LLQtSDQuNC80LXQvdC4LCDQvdC+INCx0YvQu9C+INGD0LbQtSDQv9C+0LfQtNC90L4KICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBTV19Hb29kcy5wcm9kdWN0X251bWJlciBhcyBiYXJjb2RlLFNXX0NlbGxzLm5hbWUgYXMgY2VsbCxTV19Hb29kcy5uYW1lIGFzIG5vbSwgaWZudWxsKHN1bShxdHkpLDApIGFzIHF0eSwgXCJ1bmlxdWVcIiBhcyB1bixTV19Hb29kcy5pZCBhcyBub21faWQgIEZST00gU1dfQWNjb3VudCBMRUZUIEpPSU4gU1dfR29vZHMgT04gU1dfQWNjb3VudC5za3U9U1dfR29vZHMuaWQgTEVGVCBKT0lOIFNXX0NlbGxzIE9OIFNXX0FjY291bnQuY2VsbD1TV19DZWxscy5pZCBXSEVSRSBTV19BY2NvdW50LmNlbGwgPSAiICtzdHIoY2VsbGlkKSsgIiBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lIEhBVklORyBpZm51bGwoc3VtKHF0eSksMCk8PjAiKQogICAgICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGUpICAgIAoKICAgICAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKCiAgICAgICAgeWVsbG93X2xpc3QgPSBbXQogICAgICAgIHJlZF9saXN0PSBbXQogICAgICAgIGluZm9fbGlzdCA9IFtdCiAgICAgICAgI9C40YHQv9C+0LvRjNC30YPQtdC8IG9iamVjdF9pbmZvX2xpc3Qg0Lgg0LfQsNC/0YDQvtGBINGH0YLQvtCx0Ysg0YXRgNCw0L3QuNGC0Ywg0LfQsNC+0LTQvdC+INC90YPQttC90YvQtSDQv9C+0LvRjywg0L7QvdC4INC90YPQttC90Ysg0L3QtSDQtNC70Y8g0L7RgtC+0LHRgNCw0LTQsNC10L3QuNGPINCwINC00LvRjyDQtNCw0LvRjNC90LXQudGI0LXQuSDQu9C+0LPQuNC60LggLSB1bmlxdWUsIG5vbV9pZAogICAgICAgIAogICAgICAgIGZvciBsaW5rIGluIHJlc3VsdHM6CiAgICAgICAgICAgIGpvYiA9IHsib2JqZWN0IjpzdHIobGlua1swXSksImluZm8iOnN0cihsaW5rWzJdKSsiIDwvbj4g0J7RgdGC0LDRgtC+0Lo6IDxiaWc+IitzdHIobGlua1szXSkrIjwvYmlnPiIsInVuaXF1ZSI6bGlua1s0XSwibm9tX2lkIjpzdHIobGlua1s1XSl9CiAgICAgICAgICAgIGluZm9fbGlzdC5hcHBlbmQoam9iKQogICAgICAgICAgICB5ZWxsb3dfbGlzdC5hcHBlbmQobGlua1swXSkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICBjb25uLmNsb3NlKCkgICAgIAoKICAgICAgICBoYXNoTWFwLnB1dCgib2JqZWN0X2luZm9fbGlzdCIsanNvbi5kdW1wcyhpbmZvX2xpc3QsZW5zdXJlX2FzY2lpPUZhbHNlKSkKICAgICAgICBoYXNoTWFwLnB1dCgieWVsbG93X2xpc3QiLCc7Jy5qb2luKHllbGxvd19saXN0KSkKCiAgICAgICAgCgogICAgICAgIGhhc2hNYXAucHV0KCJOZXh0U3RlcCIsItCi0L7QstCw0YDRiyDRj9GH0LXQudC60LgiKQogICAgICAgIAogICAgcmV0dXJuIGhhc2hNYXAgICAgIAoKCmRlZiBpbnZjdl9jZWxsX29uX25ld19vYmplY3QoaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBjZWxscwogICAgZ2xvYmFsIGNlbGxpZAogICAgZ2xvYmFsIGdyZWVuX3NpemUseWVsbG93X3NpemUKCiAgICAKICAgIGhhc2hNYXAucHV0KCJ2aWJyYXRlIiwiIikKCiAgICBjZWxsaWQ9Y2VsbHMuZ2V0KGhhc2hNYXAuZ2V0KCJjdXJyZW50X29iamVjdCIpKQoKICAgIGlmIG5vdCBjZWxsaWQ9PU5vbmU6CiAgICAKICAgICAgICAjY3JlYXRlIGNvbm5lY3Rpb24gd2l0aCBkYXRhYmFzZQogICAgICAgIGNvbm49IE5vbmUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJy8vZGF0YS9kYXRhL3J1LnRyYXZlbGZvb2Quc2ltcGxlX3VpL2RhdGFiYXNlcy9TaW1wbGVXTVMnKQogICAgICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQogICAgCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHRyeToKICAgICAgICAgICAgIyDRgtGD0YIg0Y8g0L/QvtC90Y/QuyDRh9GC0L4g0LvQsNC20LDQvdGD0LvRgdGPLCDQuNGB0L/QvtC70YzQt9C+0LLQsNCyIHVuaXF1ZSDQsiDQutCw0YfQtdGB0YLQstC1INC40LzQtdC90LgsINC90L4g0LHRi9C70L4g0YPQttC1INC/0L7Qt9C00L3QvgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIFNXX0dvb2RzLmJhcmNvZGUgYXMgYmFyY29kZSxTV19DZWxscy5uYW1lIGFzIGNlbGwsU1dfR29vZHMubmFtZSBhcyBub20sIGlmbnVsbChzdW0ocXR5KSwwKSBhcyBxdHksIFwidW5pcXVlXCIgYXMgdW4sU1dfR29vZHMuaWQgYXMgbm9tX2lkICBGUk9NIFNXX0FjY291bnQgTEVGVCBKT0lOIFNXX0dvb2RzIE9OIFNXX0FjY291bnQuc2t1PVNXX0dvb2RzLmlkIExFRlQgSk9JTiBTV19DZWxscyBPTiBTV19BY2NvdW50LmNlbGw9U1dfQ2VsbHMuaWQgV0hFUkUgU1dfQWNjb3VudC5jZWxsID0gIiArc3RyKGNlbGxpZCkrICIgR1JPVVAgQlkgU1dfR29vZHMubmFtZSAsU1dfQ2VsbHMubmFtZSBIQVZJTkcgaWZudWxsKHN1bShxdHkpLDApPD4wIikKICAgICAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihlKSAgICAKCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgICAgIGZvdW5kPVtdCgogICAgICAgIHllbGxvd19saXN0ID0gW10KICAgICAgICByZWRfbGlzdD0gW10KICAgICAgICBpbmZvX2xpc3QgPSBbXQogICAgICAgIHllbGxvd19zaXplPTAKICAgICAgICBncmVlbl9zaXplPTAKICAgICAgICAj0LjRgdC/0L7Qu9GM0LfRg9C10Lwgb2JqZWN0X2luZm9fbGlzdCDQuCDQt9Cw0L/RgNC+0YEg0YfRgtC+0LHRiyDRhdGA0LDQvdC40YLRjCDQt9Cw0L7QtNC90L4g0L3Rg9C20L3Ri9C1INC/0L7Qu9GPLCDQvtC90Lgg0L3Rg9C20L3RiyDQvdC1INC00LvRjyDQvtGC0L7QsdGA0LDQtNCw0LXQvdC40Y8g0LAg0LTQu9GPINC00LDQu9GM0L3QtdC50YjQtdC5INC70L7Qs9C40LrQuCAtIHVuaXF1ZSwgbm9tX2lkCiAgICAgICAgZm9yIGxpbmsgaW4gcmVzdWx0czoKICAgICAgICAgICAgam9iID0geyJvYmplY3QiOnN0cihsaW5rWzBdKSwiaW5mbyI6c3RyKGxpbmtbMl0pKyIgPC9uPiDQntGB0YLQsNGC0L7QujogPGJpZz4iK3N0cihsaW5rWzNdKSsiPC9iaWc+IiwidW5pcXVlIjpsaW5rWzRdLCJub21faWQiOnN0cihsaW5rWzVdKX0KICAgICAgICAgICAgaW5mb19saXN0LmFwcGVuZChqb2IpCiAgICAgICAgICAgIHllbGxvd19saXN0LmFwcGVuZChsaW5rWzBdKQogICAgICAgICAgICB5ZWxsb3dfc2l6ZSs9MQoKICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgIGNvbm4uY2xvc2UoKSAgICAgCgogICAgICAgIGhhc2hNYXAucHV0KCJvYmplY3RfaW5mb19saXN0Iixqc29uLmR1bXBzKGluZm9fbGlzdCxlbnN1cmVfYXNjaWk9RmFsc2UpKQogICAgICAgIGhhc2hNYXAucHV0KCJ5ZWxsb3dfbGlzdCIsJzsnLmpvaW4oeWVsbG93X2xpc3QpKQoKICAgICAgICAKICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnYiLCLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIrc3RyKGhhc2hNYXAuZ2V0KCJpbnZfbmFtZSIpKSsiINC+0YIgIitpbnZkYXRlLnN0cmZ0aW1lKCIlbS4lZC4lWSwgJUg6JU06JVMiKSsiPC9uPiDQndCw0LnQtNC10L3QvjogPGJpZz4iK3N0cihncmVlbl9zaXplKSsiPC9iaWc+IisiINC40LcgIisiPGJpZz4iK3N0cih5ZWxsb3dfc2l6ZSkrIjwvYmlnPiIpCgoKICAgICAgICBoYXNoTWFwLnB1dCgiTmV4dFN0ZXAiLCLQotC+0LLQsNGA0Ysg0Y/Rh9C10LnQutC4IikKICAgICAgICAKICAgIHJldHVybiBoYXNoTWFwICAgICAKCmRlZiBpbnZjdl9nb29kc19vbl9uZXdfb2JqZWN0KGhhc2hNYXAsX2ZpbGVzPU5vbmUsX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbHMKICAgIGdsb2JhbCBjZWxsaWQKICAgIGdsb2JhbCBncmVlbl9zaXplLHllbGxvd19zaXplCgogICAgCiAgICAKICAgIG5vbV9iYXJjb2RlID0gc3RyKGhhc2hNYXAuZ2V0KCJjdXJyZW50X29iamVjdCIpKQoKICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoInN0b3BfbGlzdGVuZXJfbGlzdCIpOgogICAgICAgICAgICBzdG9wX2xpc3QgPSBoYXNoTWFwLmdldCgic3RvcF9saXN0ZW5lcl9saXN0Iikuc3BsaXQoIjsiKQogICAgICAgICAgICBzdG9wX2xpc3QuYXBwZW5kKG5vbV9iYXJjb2RlKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgic3RvcF9saXN0ZW5lcl9saXN0IiwiOyIuam9pbihzdG9wX2xpc3QpKQogICAgZWxzZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInN0b3BfbGlzdGVuZXJfbGlzdCIsbm9tX2JhcmNvZGUpCgogICAgCiAgICBvYmplY3RfbGlzdCA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoIm9iamVjdF9pbmZvX2xpc3QiKSkKICAgIAogICAgdHJ5OgogICAgICAgIG5vbV9yZWNvcmQgPSBuZXh0KGl0ZW0gZm9yIGl0ZW0gaW4gb2JqZWN0X2xpc3QgaWYgc3RyKGl0ZW1bIm9iamVjdCJdKSA9PSBzdHIobm9tX2JhcmNvZGUpKQoKICAgIGV4Y2VwdCBTdG9wSXRlcmF0aW9uOgogICAgICAgIG5vbV9yZWNvcmQgPSBOb25lCgogICAgaWYgbm90IG5vbV9yZWNvcmQgPT0gTm9uZToKICAgICAgICBoYXNoTWFwLnB1dCgibm9tX2lkIixzdHIobm9tX3JlY29yZC5nZXQoIm5vbV9pZCIpKSkKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0Iiwibm9tX2lkPSIrc3RyKGhhc2hNYXAuZ2V0KCJub21faWQiKSkrIiBpbnZfaWQ9IitzdHIoaGFzaE1hcC5nZXQoImludl9pZCIpKSkKICAgICAgICBpZiBub21fcmVjb3JkWyd1bmlxdWUnXT09MToKICAgICAgICAgICAgIAogICAgICAgICAgICAgaGFzaE1hcC5wdXQoInZpYnJhdGUiLCIiKQogICAgICAgICAgICAgaGFzaE1hcC5wdXQoImJlZXAiLCI1IikKICAgICAgICAgICAgIAogICAgICAgICAgICAgCiAgICAgICAgICAgICAj0Y3RgtC+INGD0L3QuNC60LDQu9GM0L3Ri9C5INGI0YLRgNC40YXQutC+0LQgLSDQtNC+0LHQsNCy0LvRj9C10Lwg0LXQs9C+INCyINC30LXQu9C10L3Ri9C5INGB0L/QuNGB0L7QuiDRgdGA0LDQt9GDINC4INGD0LHQuNGA0LDQtdC8INC40Lcg0LbQtdC70YLQvtCz0L4KICAgICAgICAgICAgIGdyZWVuX3NpemU9MAogICAgICAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgiZ3JlZW5fbGlzdCIpOgogICAgICAgICAgICAgICAgZ3JlZW5fbGlzdCA9IGhhc2hNYXAuZ2V0KCJncmVlbl9saXN0Iikuc3BsaXQoIjsiKQogICAgICAgICAgICAgICAgZ3JlZW5fbGlzdC5hcHBlbmQobm9tX2JhcmNvZGUpCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsIjsiLmpvaW4oZ3JlZW5fbGlzdCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsCiAgICAgICAgICAgICAgICBub21fYmFyY29kZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgCiAgICAgICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCJ5ZWxsb3dfbGlzdCIpOgogICAgICAgICAgICAgICAgeWVsbG93X2xpc3QgPSBoYXNoTWFwLmdldCgieWVsbG93X2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgICAgICB5ZWxsb3dfbGlzdC5yZW1vdmUobm9tX2JhcmNvZGUpCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgieWVsbG93X2xpc3QiLCI7Ii5qb2luKHllbGxvd19saXN0KSkgCiAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgI9C00L7QsdCw0LLQu9GP0LXQvCDQsiDQsdCw0LfRgyAtINC+0L0g0L/QvtGB0YfQuNGC0LDQvQogICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgZm91bmQuYXBwZW5kKGludChoYXNoTWFwLmdldCgibm9tX2lkIikpKSAKICAgICAgICAgICAgICAgIGludmVudG9yeSA9IHVpX2dsb2JhbC5TV19JbnZlbnRvcnlbaW50KGhhc2hNYXAuZ2V0KCJpbnZfaWQiKSldCiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0ludmVudG9yeV9saW5lKHF0eT0xLHNrdT1pbnQoaGFzaE1hcC5nZXQoIm5vbV9pZCIpKSxjZWxsPWNlbGxpZCxpbnZlbnRvcnk9aW52ZW50b3J5KQogICAgICAgICAgICAgICAgY29tbWl0KCkgIAoKICAgICAgICAgICAgIGdyZWVuX3NpemUrPTEgICAKICAgICAgICAgICAgIGludmRhdGUgPSBkYXRldGltZS5mcm9taXNvZm9ybWF0KHN0cihoYXNoTWFwLmdldCgiaW52X2RhdGUiKSkpCiAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiaW52Iiwi0JjQvdCy0LXQvdGC0LDRgNC40LfQsNGG0LjRjyAiK3N0cihoYXNoTWFwLmdldCgiaW52X25hbWUiKSkrIiDQvtGCICIraW52ZGF0ZS5zdHJmdGltZSgiJW0uJWQuJVksICVIOiVNOiVTIikrIjwvbj4g0J3QsNC50LTQtdC90L46IDxiaWc+IitzdHIoZ3JlZW5fc2l6ZSkrIjwvYmlnPiIrIiDQuNC3ICIrIjxiaWc+IitzdHIoeWVsbG93X3NpemUpKyI8L2JpZz4iKSAgIAogICAgICAgIGVsc2U6ICAgI9C90LXRg9C90LjQutCw0LvRjNC90YvQuSDRiNGC0YDQuNGF0LrQvtC0IC0g0L/RgNC+0YHQuNC8INCy0LLQtdGB0YLQuCDQutC+0Lst0LLQviAKICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJiZWVwIiwiNTAiKQogICAgICAgICAgICAgCiAgICAgICAgICAgICBoYXNoTWFwLnB1dCgibm9tIixub21fcmVjb3JkLmdldCgiaW5mbyIpKQogICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm5vbV9iYXJjb2RlIixub21fYmFyY29kZSkKICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nUHJvY2VzcyIsItCY0L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8gQWN0aXZlIENWIikKICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nIiwi0JTQuNCw0LvQvtCz0JLQstC+0LTQmtC+0LvQuNGH0LXRgdGC0LLQsCIpCiAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZ1N0eWxlIixqc29uLmR1bXBzKHsidGl0bGUiOiAi0JLQstC10LTQuNGC0LUg0LrQvtC70LjRh9C10YHRgtCy0L4g0YTQsNC60YIiLCAieWVzIjogItCf0L7QtNGC0LLQtdGA0LTQuNGC0YwiLCAgICJubyI6ICLQntGC0LzQtdC90LAiIH0pKQogICAgICAKICAgIAogICAgCiAgICAKICAgICAgIAogICAgICAgIAogICAgcmV0dXJuIGhhc2hNYXAgICAgICAgICAKCmRlZiBpbnZjdl9nb29kc19hY3Rpb24oaGFzaE1hcCxfZmlsZXM9Tm9uZSxfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBjZWxsaWQKICAgIGdsb2JhbCBncmVlbl9zaXplLHllbGxvd19zaXplCgogICAgI2hhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGhhc2hNYXAuZ2V0KCJldmVudCIpKSkKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKT09Im9uUmVzdWx0UG9zaXRpdmUiOiAKCiAgICAgICAgICBoYXNoTWFwLnB1dCgidmlicmF0ZSIsIiIpCiAgICAgICAgICBub21fYmFyY29kZSA9IHN0cihoYXNoTWFwLmdldCgibm9tX2JhcmNvZGUiKSkgIAogICAgICAgICAgI9C/0LXRgNC10LrRgNCw0YjQuNCy0LDQtdC8INCyINC30LXQu9C10L3Ri9C5CiAgICAgICAgICAKICAgICAgICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoImdyZWVuX2xpc3QiKToKICAgICAgICAgICAgICAgIGdyZWVuX2xpc3QgPSBoYXNoTWFwLmdldCgiZ3JlZW5fbGlzdCIpLnNwbGl0KCI7IikKICAgICAgICAgICAgICAgIGdyZWVuX2xpc3QuYXBwZW5kKG5vbV9iYXJjb2RlKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImdyZWVuX2xpc3QiLCI7Ii5qb2luKGdyZWVuX2xpc3QpKQogICAgICAgICAgICAgICAKICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsbm9tX2JhcmNvZGUpCiAgICAgICAgICAgICAgICAKCiAgICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCJ5ZWxsb3dfbGlzdCIpOgogICAgICAgICAgICAgICAgeWVsbG93X2xpc3QgPSBoYXNoTWFwLmdldCgieWVsbG93X2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgICAgICB5ZWxsb3dfbGlzdC5yZW1vdmUobm9tX2JhcmNvZGUpCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgieWVsbG93X2xpc3QiLCI7Ii5qb2luKHllbGxvd19saXN0KSkgICAgCiAgICAgICAgICAgICAgIAogICAgICAgICAgI9C00L7QsdCw0LLQu9GP0LXQvCDQsiDQsdCw0LfRgwogICAgICAgICAgaWYgZ2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwicXR5Iik+MDoKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgaW52ZW50b3J5ID0gdWlfZ2xvYmFsLlNXX0ludmVudG9yeVtpbnQoaGFzaE1hcC5nZXQoImludl9pZCIpKV0KICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfSW52ZW50b3J5X2xpbmUocXR5PWdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsInF0eSIpLHNrdT1pbnQoaGFzaE1hcC5nZXQoIm5vbV9pZCIpKSxjZWxsPWNlbGxpZCxpbnZlbnRvcnk9aW52ZW50b3J5KQogICAgICAgICAgICAgICAgY29tbWl0KCkgICAKICAgICAgICAgICAgICAgIGZvdW5kLmFwcGVuZChpbnQoaGFzaE1hcC5nZXQoIm5vbV9pZCIpKSkgCiAgICAgICAgICAgICAgICBncmVlbl9zaXplKz0xCiAgICAgICAgICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludiIsItCY0L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8gIitzdHIoaGFzaE1hcC5nZXQoImludl9uYW1lIikpKyIg0L7RgiAiK2ludmRhdGUuc3RyZnRpbWUoIiVtLiVkLiVZLCAlSDolTTolUyIpKyI8L24+INCd0LDQudC00LXQvdC+OiA8YmlnPiIrc3RyKGdyZWVuX3NpemUpKyI8L2JpZz4iKyIg0LjQtyA6IisiPGJpZz4iK3N0cih5ZWxsb3dfc2l6ZSkrIjwvYmlnPiIpCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIik9PSLQmiDQr9Cn0JXQmdCa0JUiOgogICAgICAgIGhhc2hNYXAucHV0KCJOZXh0U3RlcCIsItCS0YvQsdC+0YAg0Y/Rh9C10LnQutC4IikKICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnYiLCLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIrc3RyKGhhc2hNYXAuZ2V0KCJpbnZfbmFtZSIpKSsiINC+0YIgIitpbnZkYXRlLnN0cmZ0aW1lKCIlbS4lZC4lWSwgJUg6JU06JVMiKSkKCiAgICByZXR1cm4gaGFzaE1hcA==",
        "PyFiles": [
            {
                "PyFileKey": "ui_global",
                "PyFileData": "ZnJvbSB0b2tlbml6ZSBpbXBvcnQgRG91YmxlCmZyb20gcG9ueSBpbXBvcnQgb3JtCmZyb20gcG9ueS5vcm0gaW1wb3J0IERhdGFiYXNlLFJlcXVpcmVkLFNldCxKc29uLFByaW1hcnlLZXksT3B0aW9uYWwKZnJvbSBwb255Lm9ybS5jb3JlIGltcG9ydCBkYl9zZXNzaW9uCmltcG9ydCBkYXRldGltZQoKZGIgPSBEYXRhYmFzZSgpCmRiLmJpbmQocHJvdmlkZXI9J3NxbGl0ZScsIGZpbGVuYW1lPScvL2RhdGEvZGF0YS9ydS50cmF2ZWxmb29kLnNpbXBsZV91aS9kYXRhYmFzZXMvU2ltcGxlV01TJywgY3JlYXRlX2RiPVRydWUpCgpjbGFzcyBTV19Vbml0cyhkYi5FbnRpdHkpOgogICAgICAgIG5hbWUgPSAgUmVxdWlyZWQoc3RyKQoKY2xhc3MgU1dfR3JvdXBzKGRiLkVudGl0eSk6CiAgICAgICAgbmFtZSA9ICBSZXF1aXJlZChzdHIpCgpjbGFzcyBTV19DZWxscyhkYi5FbnRpdHkpOgogICAgICAgIG5hbWUgPSAgUmVxdWlyZWQoc3RyKQogICAgICAgIGJhcmNvZGUgPSAgT3B0aW9uYWwoc3RyKQogICAgICAgIApjbGFzcyBTV19Hb29kcyhkYi5FbnRpdHkpOgogICAgICAgIG5hbWUgPSAgUmVxdWlyZWQoc3RyKQogICAgICAgIHByb2R1Y3RfbnVtYmVyID0gIE9wdGlvbmFsKHN0cikKICAgICAgICBiYXJjb2RlID0gIE9wdGlvbmFsKHN0cikKICAgICAgICBncm91cCA9IE9wdGlvbmFsKHN0cikKICAgICAgICB1bmlxdWUgPSBPcHRpb25hbChpbnQpCiAgICAgICAgdW5pdCA9IFJlcXVpcmVkKHN0cikKICAgICAgICBwcmljZSA9IE9wdGlvbmFsKGZsb2F0KQogICAgICAgIHBpY3R1cmVzID0gT3B0aW9uYWwoSnNvbikKICAgICAgICBjcmVhdGVkX2F0ID0gT3B0aW9uYWwoZGF0ZXRpbWUuZGF0ZXRpbWUsIHNxbF9kZWZhdWx0PSdDVVJSRU5UX1RJTUVTVEFNUCcpCgpjbGFzcyBTV19BY2NvdW50KGRiLkVudGl0eSk6CiAgICAgICAgc2t1ID0gIFJlcXVpcmVkKGludCkKICAgICAgICBjZWxsID0gIFJlcXVpcmVkKGludCkKICAgICAgICBxdHkgPSAgUmVxdWlyZWQoZmxvYXQpCiAgICAgICAgCiAgICAgICAgcGVyaW9kID0gT3B0aW9uYWwoZGF0ZXRpbWUuZGF0ZXRpbWUsIHNxbF9kZWZhdWx0PSdDVVJSRU5UX1RJTUVTVEFNUCcpCiAgICAgICAKCmNsYXNzIFNXX0ludmVudG9yeShkYi5FbnRpdHkpOgogICAgICAgIGRlc2NyaXB0aW9uID0gIFJlcXVpcmVkKHN0cikKICAgICAgICBjcmVhdGVkX2F0ID0gT3B0aW9uYWwoZGF0ZXRpbWUuZGF0ZXRpbWUsIHNxbF9kZWZhdWx0PSdDVVJSRU5UX1RJTUVTVEFNUCcpIAogICAgICAgIGxpbmVzID0gU2V0KCJTV19JbnZlbnRvcnlfbGluZSIpICAgIAoKY2xhc3MgU1dfSW52ZW50b3J5X2xpbmUoZGIuRW50aXR5KToKICAgICAgICBza3UgPSAgUmVxdWlyZWQoaW50KQogICAgICAgIGNlbGwgPSAgUmVxdWlyZWQoaW50KQogICAgICAgIHF0eSA9ICBSZXF1aXJlZChmbG9hdCkKICAgICAgICBpbnZlbnRvcnkgPSBSZXF1aXJlZCgiU1dfSW52ZW50b3J5IikKICAgICAgICAKICAgICAgICBkYXRlID0gT3B0aW9uYWwoZGF0ZXRpbWUuZGF0ZXRpbWUsIHNxbF9kZWZhdWx0PSdDVVJSRU5UX1RJTUVTVEFNUCcpICAgICAgICAgIAoKZGVmIGluaXQoKToKICAgIGRiLmdlbmVyYXRlX21hcHBpbmcoY3JlYXRlX3RhYmxlcz1UcnVlKSA="
            }
        ],
        "PyTimerTask": [
            {
                "PyTimerTaskKey": "on_start",
                "PyTimerTaskDef": "init_on_start",
                "PyTimerTaskPeriod": "-1",
                "PyTimerTaskBuilIn": false
            }
        ],
        "RecognitionTemplates": [
            {
                "name": "Распознавание артикула",
                "TypeRecognition": "Распознавание текста",
                "mesure_qty": "1",
                "min_freq": "1",
                "min_length": "3",
                "max_length": "15",
                "query": "c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/",
                "ReplaceO": true,
                "ToUpcase": false,
                "control_field": "product_number",
                "result_field": "id",
                "cursor": [
                    {
                        "title": "id",
                        "var": "nom_id",
                        "field": "id"
                    }
                ],
                "result_var": "nom_id"
            }
        ]
    }
}